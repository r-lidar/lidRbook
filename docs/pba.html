<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Derived metrics at point level | The lidR package</title>
  <meta name="description" content="A guide to the lidR package" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Derived metrics at point level | The lidR package" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide to the lidR package" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Derived metrics at point level | The lidR package" />
  
  <meta name="twitter:description" content="A guide to the lidR package" />
  

<meta name="author" content="Jean-Romain Roussel, Tristan R.H. Goodbody, Piotr Tompalski" />


<meta name="date" content="2021-12-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="vba.html"/>
<link rel="next" href="engine.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>2</b> Reading, Plotting, Querying &amp; Validating</a>
<ul>
<li class="chapter" data-level="2.1" data-path="io.html"><a href="io.html#read"><i class="fa fa-check"></i><b>2.1</b> Reading LiDAR data using <code>readLAS</code></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="io.html"><a href="io.html#select"><i class="fa fa-check"></i><b>2.1.1</b> Parameter <code>select</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="io.html"><a href="io.html#filter"><i class="fa fa-check"></i><b>2.1.2</b> Parameter <code>filter</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="io.html"><a href="io.html#asprs-compliance"><i class="fa fa-check"></i><b>2.2</b> Validating lidar data</a></li>
<li class="chapter" data-level="2.3" data-path="io.html"><a href="io.html#plot"><i class="fa fa-check"></i><b>2.3</b> Plotting</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="io.html"><a href="io.html#plot-3d"><i class="fa fa-check"></i><b>2.3.1</b> Basic 3D rendering</a></li>
<li class="chapter" data-level="2.3.2" data-path="io.html"><a href="io.html#plot-overlay"><i class="fa fa-check"></i><b>2.3.2</b> Overlays</a></li>
<li class="chapter" data-level="2.3.3" data-path="io.html"><a href="io.html#plot-advanced"><i class="fa fa-check"></i><b>2.3.3</b> Advanced 3D rendering</a></li>
<li class="chapter" data-level="2.3.4" data-path="io.html"><a href="io.html#voxel-rendering"><i class="fa fa-check"></i><b>2.3.4</b> Voxel rendering</a></li>
<li class="chapter" data-level="2.3.5" data-path="io.html"><a href="io.html#plot-crossection"><i class="fa fa-check"></i><b>2.3.5</b> Cross sections 2D rendering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gnd.html"><a href="gnd.html"><i class="fa fa-check"></i><b>3</b> Ground classification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="gnd.html"><a href="gnd.html#pmf"><i class="fa fa-check"></i><b>3.1</b> Progressive Morphological Filter</a></li>
<li class="chapter" data-level="3.2" data-path="gnd.html"><a href="gnd.html#csf"><i class="fa fa-check"></i><b>3.2</b> Cloth Simulation Function</a></li>
<li class="chapter" data-level="3.3" data-path="gnd.html"><a href="gnd.html#edge-artifact"><i class="fa fa-check"></i><b>3.3</b> Edge artifacts</a></li>
<li class="chapter" data-level="3.4" data-path="gnd.html"><a href="gnd.html#method-selection"><i class="fa fa-check"></i><b>3.4</b> How to choose a method and its parameters?</a></li>
<li class="chapter" data-level="3.5" data-path="gnd.html"><a href="gnd.html#other"><i class="fa fa-check"></i><b>3.5</b> Other methods</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dtm.html"><a href="dtm.html"><i class="fa fa-check"></i><b>4</b> Digital terrain model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dtm.html"><a href="dtm.html#tin"><i class="fa fa-check"></i><b>4.1</b> Triangular irregular network</a></li>
<li class="chapter" data-level="4.2" data-path="dtm.html"><a href="dtm.html#idw"><i class="fa fa-check"></i><b>4.2</b> Invert distance weighting</a></li>
<li class="chapter" data-level="4.3" data-path="dtm.html"><a href="dtm.html#kriging"><i class="fa fa-check"></i><b>4.3</b> Kriging</a></li>
<li class="chapter" data-level="4.4" data-path="dtm.html"><a href="dtm.html#dtm-pros-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="dtm.html"><a href="dtm.html#dtm-other"><i class="fa fa-check"></i><b>4.5</b> Other methods</a></li>
<li class="chapter" data-level="4.6" data-path="dtm.html"><a href="dtm.html#hillshade"><i class="fa fa-check"></i><b>4.6</b> Render shaded DTM</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="norm.html"><a href="norm.html"><i class="fa fa-check"></i><b>5</b> Height normalization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="norm.html"><a href="norm.html#norm-dtm"><i class="fa fa-check"></i><b>5.1</b> DTM normalization</a></li>
<li class="chapter" data-level="5.2" data-path="norm.html"><a href="norm.html#norm-point-cloud"><i class="fa fa-check"></i><b>5.2</b> Point cloud normalization</a></li>
<li class="chapter" data-level="5.3" data-path="norm.html"><a href="norm.html#hybrid-method"><i class="fa fa-check"></i><b>5.3</b> Hybrid method</a></li>
<li class="chapter" data-level="5.4" data-path="norm.html"><a href="norm.html#norm-pros-cons"><i class="fa fa-check"></i><b>5.4</b> Pros and cons</a></li>
<li class="chapter" data-level="5.5" data-path="norm.html"><a href="norm.html#norm-reverse"><i class="fa fa-check"></i><b>5.5</b> Reversing normalization</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chm.html"><a href="chm.html"><i class="fa fa-check"></i><b>6</b> Digital Surface Model and Canopy Height model</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chm.html"><a href="chm.html#p2r"><i class="fa fa-check"></i><b>6.1</b> Point-to-raster</a></li>
<li class="chapter" data-level="6.2" data-path="chm.html"><a href="chm.html#chm-tin"><i class="fa fa-check"></i><b>6.2</b> Triangulation</a></li>
<li class="chapter" data-level="6.3" data-path="chm.html"><a href="chm.html#pitfree"><i class="fa fa-check"></i><b>6.3</b> Pit-free algorithm</a></li>
<li class="chapter" data-level="6.4" data-path="chm.html"><a href="chm.html#chm-post-process"><i class="fa fa-check"></i><b>6.4</b> Post-processing a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="itd-its.html"><a href="itd-its.html"><i class="fa fa-check"></i><b>7</b> Indivitual tree dectection and segmentation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="itd-its.html"><a href="itd-its.html#itd"><i class="fa fa-check"></i><b>7.1</b> Individual Tree Detection (ITD)</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="itd-its.html"><a href="itd-its.html#lmffw"><i class="fa fa-check"></i><b>7.1.1</b> Local Maximum Filter with fixed windows size</a></li>
<li class="chapter" data-level="7.1.2" data-path="itd-its.html"><a href="itd-its.html#lmfvw"><i class="fa fa-check"></i><b>7.1.2</b> Local Maximum Filter with variable windows size</a></li>
<li class="chapter" data-level="7.1.3" data-path="itd-its.html"><a href="itd-its.html#lmfchm"><i class="fa fa-check"></i><b>7.1.3</b> Local Maximum Filter on a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="itd-its.html"><a href="itd-its.html#its"><i class="fa fa-check"></i><b>7.2</b> Individual Tree Segmentation (ITS)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="itd-its.html"><a href="itd-its.html#its-cloud"><i class="fa fa-check"></i><b>7.2.1</b> Segmentation of the point-cloud</a></li>
<li class="chapter" data-level="7.2.2" data-path="itd-its.html"><a href="itd-its.html#its-chm"><i class="fa fa-check"></i><b>7.2.2</b> Segmentation of the CHM</a></li>
<li class="chapter" data-level="7.2.3" data-path="itd-its.html"><a href="itd-its.html#its-comparaison"><i class="fa fa-check"></i><b>7.2.3</b> Comparaison of tree segmentations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="metrics.html"><a href="metrics.html"><i class="fa fa-check"></i><b>8</b> Derived metrics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="metrics.html"><a href="metrics.html#metrics-basics"><i class="fa fa-check"></i><b>8.1</b> The basics</a></li>
<li class="chapter" data-level="8.2" data-path="metrics.html"><a href="metrics.html#metrics-user-defined"><i class="fa fa-check"></i><b>8.2</b> User-defined metrics</a></li>
<li class="chapter" data-level="8.3" data-path="metrics.html"><a href="metrics.html#metrics-pre-defined"><i class="fa fa-check"></i><b>8.3</b> Pre-defined metrics</a></li>
<li class="chapter" data-level="8.4" data-path="metrics.html"><a href="metrics.html#metrics-3rd-party"><i class="fa fa-check"></i><b>8.4</b> Metrics using 3rd party packages</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="metrics.html"><a href="metrics.html#metrics-lmom"><i class="fa fa-check"></i><b>8.4.1</b> L-moments</a></li>
<li class="chapter" data-level="8.4.2" data-path="metrics.html"><a href="metrics.html#metrics-fractal-dims"><i class="fa fa-check"></i><b>8.4.2</b> Fractal dimensions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cba.html"><a href="cba.html"><i class="fa fa-check"></i><b>9</b> Derived metrics at the cloud level</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cba.html"><a href="cba.html#cba-overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="cba.html"><a href="cba.html#cba-applications"><i class="fa fa-check"></i><b>9.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="aba.html"><a href="aba.html"><i class="fa fa-check"></i><b>10</b> Derived metrics at the pixel level</a>
<ul>
<li class="chapter" data-level="10.1" data-path="aba.html"><a href="aba.html#aba-overview"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="aba.html"><a href="aba.html#aba-applications"><i class="fa fa-check"></i><b>10.2</b> Applications</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="aba.html"><a href="aba.html#aba-applications-modeling"><i class="fa fa-check"></i><b>10.2.1</b> Modeling</a></li>
<li class="chapter" data-level="10.2.2" data-path="aba.html"><a href="aba.html#aba-applications-density"><i class="fa fa-check"></i><b>10.2.2</b> Density</a></li>
<li class="chapter" data-level="10.2.3" data-path="aba.html"><a href="aba.html#aba-applications-intensity"><i class="fa fa-check"></i><b>10.2.3</b> Intensity</a></li>
<li class="chapter" data-level="10.2.4" data-path="aba.html"><a href="aba.html#aba-applications-other"><i class="fa fa-check"></i><b>10.2.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tba.html"><a href="tba.html"><i class="fa fa-check"></i><b>11</b> Derived metrics at the tree level</a>
<ul>
<li class="chapter" data-level="11.1" data-path="tba.html"><a href="tba.html#tba-overview"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="tba.html"><a href="tba.html#tba-applications"><i class="fa fa-check"></i><b>11.2</b> Applications</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="tba.html"><a href="tba.html#tba-applications-tree-selection"><i class="fa fa-check"></i><b>11.2.1</b> Selection of trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="tba.html"><a href="tba.html#tba-applications-tree-inventory"><i class="fa fa-check"></i><b>11.2.2</b> Tree based inventory</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="vba.html"><a href="vba.html"><i class="fa fa-check"></i><b>12</b> Derived metrics at the voxel level</a>
<ul>
<li class="chapter" data-level="12.1" data-path="vba.html"><a href="vba.html#vba-overview"><i class="fa fa-check"></i><b>12.1</b> Overview</a></li>
<li class="chapter" data-level="12.2" data-path="vba.html"><a href="vba.html#vba-applications"><i class="fa fa-check"></i><b>12.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="pba.html"><a href="pba.html"><i class="fa fa-check"></i><b>13</b> Derived metrics at point level</a>
<ul>
<li class="chapter" data-level="13.1" data-path="pba.html"><a href="pba.html#pba-overview"><i class="fa fa-check"></i><b>13.1</b> Overview</a></li>
<li class="chapter" data-level="13.2" data-path="pba.html"><a href="pba.html#pba-applications"><i class="fa fa-check"></i><b>13.2</b> Applications</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="pba.html"><a href="pba.html#pba-applications-roof"><i class="fa fa-check"></i><b>13.2.1</b> Roof segmentation</a></li>
<li class="chapter" data-level="13.2.2" data-path="pba.html"><a href="pba.html#pba-applications-wire"><i class="fa fa-check"></i><b>13.2.2</b> Lake and wire segmentation</a></li>
<li class="chapter" data-level="13.2.3" data-path="pba.html"><a href="pba.html#pba-applications-coloring"><i class="fa fa-check"></i><b>13.2.3</b> Multi-spectral coloring</a></li>
<li class="chapter" data-level="13.2.4" data-path="pba.html"><a href="pba.html#pba-applications-outliers"><i class="fa fa-check"></i><b>13.2.4</b> Outlier filtering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="engine.html"><a href="engine.html"><i class="fa fa-check"></i><b>14</b> <code>LAScatalog</code> processing engine (1/2)</a>
<ul>
<li class="chapter" data-level="14.1" data-path="engine.html"><a href="engine.html#engine-rationale"><i class="fa fa-check"></i><b>14.1</b> Rationale for <code>LAScatalog</code> functionality</a></li>
<li class="chapter" data-level="14.2" data-path="engine.html"><a href="engine.html#engine-engine"><i class="fa fa-check"></i><b>14.2</b> The <code>LAScatalog</code> engine</a></li>
<li class="chapter" data-level="14.3" data-path="engine.html"><a href="engine.html#engine-lascatalog"><i class="fa fa-check"></i><b>14.3</b> Read a collection of files</a></li>
<li class="chapter" data-level="14.4" data-path="engine.html"><a href="engine.html#engine-asprs-compliance"><i class="fa fa-check"></i><b>14.4</b> Validation</a></li>
<li class="chapter" data-level="14.5" data-path="engine.html"><a href="engine.html#engine-clip"><i class="fa fa-check"></i><b>14.5</b> Extract Regions of interest</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="engine.html"><a href="engine.html#engine-clip-single"><i class="fa fa-check"></i><b>14.5.1</b> Extract a single ROI</a></li>
<li class="chapter" data-level="14.5.2" data-path="engine.html"><a href="engine.html#engine-clip-multiple"><i class="fa fa-check"></i><b>14.5.2</b> Multiple extractions</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="engine.html"><a href="engine.html#engine-options"><i class="fa fa-check"></i><b>14.6</b> Modification of default behavior</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="engine.html"><a href="engine.html#engine-options-ondisk"><i class="fa fa-check"></i><b>14.6.1</b> Multiple extractions on disk</a></li>
<li class="chapter" data-level="14.6.2" data-path="engine.html"><a href="engine.html#engine-options-index"><i class="fa fa-check"></i><b>14.6.2</b> Multiple extraction with point cloud indexation</a></li>
<li class="chapter" data-level="14.6.3" data-path="engine.html"><a href="engine.html#summary"><i class="fa fa-check"></i><b>14.6.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="engine.html"><a href="engine.html#engine-gnd-classification"><i class="fa fa-check"></i><b>14.7</b> Ground classification</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="engine.html"><a href="engine.html#engine-options-chunk"><i class="fa fa-check"></i><b>14.7.1</b> Chunk processing</a></li>
<li class="chapter" data-level="14.7.2" data-path="engine.html"><a href="engine.html#engine-options-chunk-buffer"><i class="fa fa-check"></i><b>14.7.2</b> Modifying buffers</a></li>
<li class="chapter" data-level="14.7.3" data-path="engine.html"><a href="engine.html#engine-options-chunk-size"><i class="fa fa-check"></i><b>14.7.3</b> Modify the chunk size</a></li>
<li class="chapter" data-level="14.7.4" data-path="engine.html"><a href="engine.html#engine-options-parallel"><i class="fa fa-check"></i><b>14.7.4</b> Parallel processing</a></li>
<li class="chapter" data-level="14.7.5" data-path="engine.html"><a href="engine.html#summary-1"><i class="fa fa-check"></i><b>14.7.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="engine.html"><a href="engine.html#engine-dtm"><i class="fa fa-check"></i><b>14.8</b> Digital Terrain Model</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="engine.html"><a href="engine.html#engine-dtm-inmemory"><i class="fa fa-check"></i><b>14.8.1</b> In memory DTM</a></li>
<li class="chapter" data-level="14.8.2" data-path="engine.html"><a href="engine.html#engine-dtm-ondisk"><i class="fa fa-check"></i><b>14.8.2</b> On disk DTM</a></li>
<li class="chapter" data-level="14.8.3" data-path="engine.html"><a href="engine.html#summary-2"><i class="fa fa-check"></i><b>14.8.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="engine.html"><a href="engine.html#engine-normalization"><i class="fa fa-check"></i><b>14.9</b> Height normalization</a></li>
<li class="chapter" data-level="14.10" data-path="engine.html"><a href="engine.html#engine-aba"><i class="fa fa-check"></i><b>14.10</b> Area Based Approach</a>
<ul>
<li class="chapter" data-level="14.10.1" data-path="engine.html"><a href="engine.html#summary-3"><i class="fa fa-check"></i><b>14.10.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.11" data-path="engine.html"><a href="engine.html#engine-itd"><i class="fa fa-check"></i><b>14.11</b> Individual Tree Detection</a>
<ul>
<li class="chapter" data-level="14.11.1" data-path="engine.html"><a href="engine.html#summary-4"><i class="fa fa-check"></i><b>14.11.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.12" data-path="engine.html"><a href="engine.html#engine-its"><i class="fa fa-check"></i><b>14.12</b> Individual Tree Segmentation</a></li>
<li class="chapter" data-level="14.13" data-path="engine.html"><a href="engine.html#engine-retile"><i class="fa fa-check"></i><b>14.13</b> Retile a catalog</a>
<ul>
<li class="chapter" data-level="14.13.1" data-path="engine.html"><a href="engine.html#retile-a-catalog-into-smaller-files"><i class="fa fa-check"></i><b>14.13.1</b> Retile a catalog into smaller files</a></li>
<li class="chapter" data-level="14.13.2" data-path="engine.html"><a href="engine.html#add-a-buffer-around-each-file"><i class="fa fa-check"></i><b>14.13.2</b> Add a buffer around each file</a></li>
<li class="chapter" data-level="14.13.3" data-path="engine.html"><a href="engine.html#create-a-new-collection-with-only-first-returns"><i class="fa fa-check"></i><b>14.13.3</b> Create a new collection with only first returns</a></li>
<li class="chapter" data-level="14.13.4" data-path="engine.html"><a href="engine.html#create-a-new-collection-of-small-and-buffered-ground-returns-in-parallel"><i class="fa fa-check"></i><b>14.13.4</b> Create a new collection of small and buffered ground returns in parallel</a></li>
</ul></li>
<li class="chapter" data-level="14.14" data-path="engine.html"><a href="engine.html#engine-independent-files"><i class="fa fa-check"></i><b>14.14</b> The case of ground inventories</a></li>
<li class="chapter" data-level="14.15" data-path="engine.html"><a href="engine.html#engine-summary-sheet"><i class="fa fa-check"></i><b>14.15</b> Summary of available options</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="engine2.html"><a href="engine2.html"><i class="fa fa-check"></i><b>15</b> LAScatalog processing engine (2/2)</a>
<ul>
<li class="chapter" data-level="15.1" data-path="engine2.html"><a href="engine2.html#engine-catalog-apply"><i class="fa fa-check"></i><b>15.1</b> <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.2" data-path="engine2.html"><a href="engine2.html#engine-user-function-generic"><i class="fa fa-check"></i><b>15.2</b> Create user-defined function</a></li>
<li class="chapter" data-level="15.3" data-path="engine2.html"><a href="engine2.html#engine-user-function-extended"><i class="fa fa-check"></i><b>15.3</b> Create an intermediate function for <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.4" data-path="engine2.html"><a href="engine2.html#engine-user-function-lascatalog"><i class="fa fa-check"></i><b>15.4</b> Make a user-friendly function for third party users</a></li>
<li class="chapter" data-level="15.5" data-path="engine2.html"><a href="engine2.html#engine-user-function-safe"><i class="fa fa-check"></i><b>15.5</b> Make a safe function for third party users</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="modeling-aba.html"><a href="modeling-aba.html"><i class="fa fa-check"></i><b>16</b> The Area-Based Approach (ABA) to forest modelling</a>
<ul>
<li class="chapter" data-level="16.1" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-read-data"><i class="fa fa-check"></i><b>16.1</b> Read in data</a></li>
<li class="chapter" data-level="16.2" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-build-data"><i class="fa fa-check"></i><b>16.2</b> ABA database building</a></li>
<li class="chapter" data-level="16.3" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-build-model"><i class="fa fa-check"></i><b>16.3</b> Statistical modeling</a></li>
<li class="chapter" data-level="16.4" data-path="modeling-aba.html"><a href="modeling-aba.html#wall-to-wall-modelling"><i class="fa fa-check"></i><b>16.4</b> Wall to wall modelling</a></li>
<li class="chapter" data-level="16.5" data-path="modeling-aba.html"><a href="modeling-aba.html#calculate-wall-to-wall-predictions"><i class="fa fa-check"></i><b>16.5</b> Calculate wall-to-wall predictions</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="outbox.html"><a href="outbox.html"><i class="fa fa-check"></i><b>17</b> Thinking outside the box</a>
<ul>
<li class="chapter" data-level="17.1" data-path="outbox.html"><a href="outbox.html#outbox-custom-metrics"><i class="fa fa-check"></i><b>17.1</b> New complex metrics in ABA</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="outbox.html"><a href="outbox.html#outbox-distance-returns"><i class="fa fa-check"></i><b>17.1.1</b> Distance between returns</a></li>
<li class="chapter" data-level="17.1.2" data-path="outbox.html"><a href="outbox.html#outbox-rumple-index"><i class="fa fa-check"></i><b>17.1.2</b> Rumple index</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="outbox.html"><a href="outbox.html#outbox-multispectral-coloring"><i class="fa fa-check"></i><b>17.2</b> Multi-spectral coloring</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="spatial-indexing.html"><a href="spatial-indexing.html"><i class="fa fa-check"></i><b>18</b> Spatial indexing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-intro"><i class="fa fa-check"></i><b>18.1</b> Introduction to spatial indexes</a></li>
<li class="chapter" data-level="18.2" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-las"><i class="fa fa-check"></i><b>18.2</b> Spatial indexes for LAS objects</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-oveview"><i class="fa fa-check"></i><b>18.2.1</b> Overview</a></li>
<li class="chapter" data-level="18.2.2" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-strategies"><i class="fa fa-check"></i><b>18.2.2</b> Spatial indexes and selection strategies</a></li>
<li class="chapter" data-level="18.2.3" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-cpp-api"><i class="fa fa-check"></i><b>18.2.3</b> C++ API</a></li>
<li class="chapter" data-level="18.2.4" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-benchmark"><i class="fa fa-check"></i><b>18.2.4</b> Benchmark</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-files"><i class="fa fa-check"></i><b>18.3</b> Spatial index for LAS files</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="plugins.html"><a href="plugins.html"><i class="fa fa-check"></i><b>19</b> <code>lidR</code> plugin system</a>
<ul>
<li class="chapter" data-level="19.1" data-path="plugins.html"><a href="plugins.html#plugin-system"><i class="fa fa-check"></i><b>19.1</b> Understanding lidR algorithms</a></li>
<li class="chapter" data-level="19.2" data-path="plugins.html"><a href="plugins.html#plugin-creation"><i class="fa fa-check"></i><b>19.2</b> Creation of the <code>mba</code> algorithm</a></li>
<li class="chapter" data-level="19.3" data-path="plugins.html"><a href="plugins.html#plugin-extensions"><i class="fa fa-check"></i><b>19.3</b> What about other algorithms?</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The <code>lidR</code> package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pba" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Derived metrics at point level</h1>
<div id="pba-overview" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Overview</h2>
<p>The “point” level of regularization corresponds to the computation of derived metrics for each point of the point cloud using its neighborhood to define a local subset. The <code>point_metrics()</code> function allows calculation of point-based metrics and works like <code>cloud_metrics()</code>, <code>grid_metrics()</code>, <code>tree_metrics()</code> or <code>voxel_metrics()</code> seen in section <a href="metrics.html#metrics">8</a>, <a href="cba.html#cba">9</a>, <a href="aba.html#aba">10</a>, <a href="tba.html#tba">11</a> and <a href="vba.html#vba">12</a>. Refer to these sections for a more comprehensive overview.</p>
<p>For each point, the neighbourhood can be either:</p>
<ol style="list-style-type: decimal">
<li>The k nearest neighbours</li>
<li>The points within a sphere centred on the processed point, or</li>
<li>The k nearest neighbours but with a limited radius search.</li>
</ol>
<p>The syntax for these 3 options is given below:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="pba.html#cb1-1" aria-hidden="true" tabindex="-1"></a>LASfile <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;Megaplot.laz&quot;</span>, <span class="at">package=</span><span class="st">&quot;lidR&quot;</span>)</span>
<span id="cb1-2"><a href="pba.html#cb1-2" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(LASfile) <span class="co"># read file</span></span>
<span id="cb1-3"><a href="pba.html#cb1-3" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">point_metrics</span>(las, <span class="sc">~</span><span class="fu">list</span>(<span class="at">imean =</span> <span class="fu">mean</span>(Intensity)), <span class="at">k =</span> <span class="dv">7</span>)        <span class="co"># 1</span></span>
<span id="cb1-4"><a href="pba.html#cb1-4" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">point_metrics</span>(las, <span class="sc">~</span><span class="fu">list</span>(<span class="at">imean =</span> <span class="fu">mean</span>(Intensity)), <span class="at">r =</span> <span class="dv">3</span>)        <span class="co"># 2</span></span>
<span id="cb1-5"><a href="pba.html#cb1-5" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">point_metrics</span>(las, <span class="sc">~</span><span class="fu">list</span>(<span class="at">imean =</span> <span class="fu">mean</span>(Intensity)), <span class="at">k =</span> <span class="dv">7</span>, <span class="at">r =</span> <span class="dv">3</span>) <span class="co"># 3</span></span></code></pre></div>
<p>The output is a <code>data.table</code> with the ID of the reference points and the metric(s) for each.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="pba.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(metrics)</span>
<span id="cb2-2"><a href="pba.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    pointID    imean</span></span>
<span id="cb2-3"><a href="pba.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:       1 41.42857</span></span>
<span id="cb2-4"><a href="pba.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:       2 41.42857</span></span>
<span id="cb2-5"><a href="pba.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:       3 33.71429</span></span>
<span id="cb2-6"><a href="pba.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:       4  3.00000</span></span>
<span id="cb2-7"><a href="pba.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5:       5 29.28571</span></span>
<span id="cb2-8"><a href="pba.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6:       6 22.00000</span></span></code></pre></div>
<p>Instead of the ID, one may prefer to get the coordinates with <code>xyz = TRUE</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="pba.html#cb3-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">point_metrics</span>(las, <span class="sc">~</span><span class="fu">list</span>(<span class="at">imean =</span> <span class="fu">mean</span>(Intensity)), <span class="at">k =</span> <span class="dv">7</span>, <span class="at">xyz =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>It is also possible to process a selection of points (excluding some points) without creating a copy of the point cloud. In the following, the mean intensity is computed excluding outliers with an intensity above 100. No metric is computed for outliers, and they are not used to get the local neighborhood of the other points.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="pba.html#cb4-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">point_metrics</span>(las, <span class="sc">~</span><span class="fu">list</span>(<span class="at">imean =</span> <span class="fu">mean</span>(Intensity)), <span class="at">k =</span> <span class="dv">7</span>, <span class="at">filter =</span> <span class="sc">~</span>Intensity <span class="sc">&lt;</span> <span class="dv">100</span> ) <span class="co"># calculate mean intensity and exclude outliers</span></span>
<span id="cb4-2"><a href="pba.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(metrics)</span>
<span id="cb4-3"><a href="pba.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    pointID    imean</span></span>
<span id="cb4-4"><a href="pba.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1:       1 41.42857</span></span>
<span id="cb4-5"><a href="pba.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2:       2 41.42857</span></span>
<span id="cb4-6"><a href="pba.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3:       3 33.71429</span></span>
<span id="cb4-7"><a href="pba.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4:       4 16.57143</span></span>
<span id="cb4-8"><a href="pba.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5:       5 29.28571</span></span>
<span id="cb4-9"><a href="pba.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6:       6 23.14286</span></span></code></pre></div>
</div>
<div id="pba-applications" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Applications</h2>
<div id="pba-applications-roof" class="section level3" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Roof segmentation</h3>
<p>Roofs are flat areas. <a href="https://doi.org/10.1016/j.patcog.2014.12.020">Limberger et al. (2015)</a> described a method to find flat areas in a point clouds using an eigen values decomposition. Using a user-defined function we can use <code>point_metrics()</code> to create this algorithm. In this example we will use the following urban scene:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="pba.html#cb5-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">&quot;data/chap11/building_WilliamsAZ_Urban_normalized.laz&quot;</span>)</span>
<span id="cb5-2"><a href="pba.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las, <span class="at">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-las-building-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>First we need to define a function that computes the eigen value decomposition of a set of points and estimates if the set of points is flat according to the <a href="https://doi.org/10.1016/j.patcog.2014.12.020">Limberger et al. (2015)</a> criteria.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="pba.html#cb6-1" aria-hidden="true" tabindex="-1"></a>is.planar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z, <span class="at">th1 =</span> <span class="dv">25</span>, <span class="at">th2 =</span> <span class="dv">6</span>) {</span>
<span id="cb6-2"><a href="pba.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  xyz <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x,y,z)</span>
<span id="cb6-3"><a href="pba.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  cov_m <span class="ot">&lt;-</span> <span class="fu">cov</span>(xyz)</span>
<span id="cb6-4"><a href="pba.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  eigen_m <span class="ot">&lt;-</span> <span class="fu">eigen</span>(cov_m)<span class="sc">$</span>value</span>
<span id="cb6-5"><a href="pba.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  is_planar <span class="ot">&lt;-</span> eigen_m[<span class="dv">2</span>] <span class="sc">&gt;</span> (th1<span class="sc">*</span>eigen_m[<span class="dv">3</span>]) <span class="sc">&amp;&amp;</span> (th2<span class="sc">*</span>eigen_m[<span class="dv">2</span>]) <span class="sc">&gt;</span> eigen_m[<span class="dv">1</span>]</span>
<span id="cb6-6"><a href="pba.html#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">planar =</span> is_planar))</span>
<span id="cb6-7"><a href="pba.html#cb6-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We then apply this function using 20 neighbors. We also use <code>filter = ~Classification != LASGROUND</code> to not process points classified as ground. We do this first, because the scene is normalized so by definition each ground point is expected to be part of a flat planar surface, and second, because it will speed-up computation because fewer points will be considered.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="pba.html#cb7-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">point_metrics</span>(las, <span class="sc">~</span><span class="fu">is.planar</span>(X,Y,Z), <span class="at">k =</span> <span class="dv">20</span>, <span class="at">filter =</span> <span class="sc">~</span>Classification <span class="sc">!=</span> LASGROUND)</span></code></pre></div>
<p>We finally merge the output with the point cloud to visualize the result:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="pba.html#cb8-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">add_attribute</span>(las, <span class="cn">FALSE</span>, <span class="st">&quot;planar&quot;</span>)</span>
<span id="cb8-2"><a href="pba.html#cb8-2" aria-hidden="true" tabindex="-1"></a>las<span class="sc">$</span>planar[M<span class="sc">$</span>pointID] <span class="ot">&lt;-</span> M<span class="sc">$</span>planar</span>
<span id="cb8-3"><a href="pba.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las, <span class="at">color =</span> <span class="st">&quot;planar&quot;</span>)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-las-building-segmented-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We can eventually set a valid classification (<code>LASBUILDING</code>) to those points:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="pba.html#cb9-1" aria-hidden="true" tabindex="-1"></a>las<span class="sc">$</span>Classification[M<span class="sc">$</span>pointID] <span class="ot">&lt;-</span> LASBUILDING</span></code></pre></div>
<p>The function <code>is.planar()</code> is highly inefficient because <code>eigen()</code> is very slow. We can rewrite the eigen decomposition in C++ with <code>Rcpp</code> to make the function 10 times faster!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="pba.html#cb10-1" aria-hidden="true" tabindex="-1"></a>Rcpp<span class="sc">::</span><span class="fu">sourceCpp</span>(<span class="at">code =</span> <span class="st">&quot;</span></span>
<span id="cb10-2"><a href="pba.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="st">#include &lt;RcppArmadillo.h&gt;</span></span>
<span id="cb10-3"><a href="pba.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">// [[Rcpp::depends(RcppArmadillo)]]</span></span>
<span id="cb10-4"><a href="pba.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">// [[Rcpp::export]]</span></span>
<span id="cb10-5"><a href="pba.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">arma::vec eigen_values(arma::mat A) {</span></span>
<span id="cb10-6"><a href="pba.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="st">arma::mat coeff, score;</span></span>
<span id="cb10-7"><a href="pba.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="st">arma::vec latent;</span></span>
<span id="cb10-8"><a href="pba.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="st">arma::princomp(coeff, score, latent, A);</span></span>
<span id="cb10-9"><a href="pba.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="st">return(latent);</span></span>
<span id="cb10-10"><a href="pba.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="st">}&quot;</span>)</span>
<span id="cb10-11"><a href="pba.html#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="pba.html#cb10-12" aria-hidden="true" tabindex="-1"></a>is.planar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z, <span class="at">th1 =</span> <span class="dv">25</span>, <span class="at">th2 =</span> <span class="dv">6</span>) {</span>
<span id="cb10-13"><a href="pba.html#cb10-13" aria-hidden="true" tabindex="-1"></a>  xyz <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x,y,z)</span>
<span id="cb10-14"><a href="pba.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  eigen_m <span class="ot">&lt;-</span> <span class="fu">eigen_values</span>(xyz)</span>
<span id="cb10-15"><a href="pba.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  is_planar <span class="ot">&lt;-</span> eigen_m[<span class="dv">2</span>] <span class="sc">&gt;</span> (th1<span class="sc">*</span>eigen_m[<span class="dv">3</span>]) <span class="sc">&amp;&amp;</span> (th2<span class="sc">*</span>eigen_m[<span class="dv">2</span>]) <span class="sc">&gt;</span> eigen_m[<span class="dv">1</span>]</span>
<span id="cb10-16"><a href="pba.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">planar =</span> is_planar))</span>
<span id="cb10-17"><a href="pba.html#cb10-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can do this… but we know that not everyone is well versed in C++. <code>lidR</code> therefore has a dedicated and even faster function (<code>segment_shapes()</code>) for this specific task because we believe that it’s of high interest to provide a specialized and faster version of this tool.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="pba.html#cb11-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">segment_shapes</span>(las, <span class="fu">shp_plane</span>(<span class="at">k =</span> <span class="dv">25</span>), <span class="st">&quot;planar&quot;</span>)</span></code></pre></div>
</div>
<div id="pba-applications-wire" class="section level3" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Lake and wire segmentation</h3>
<p>Eigen value decomposition applied using <code>point_metrics()</code> opens a lot of possibilities. For example, by tweaking the previous example we can design a lake segmentation algorithm. A lake is a planar region with a vertical normal vector, so to create a lake segmentation we simply need to add such constraints in <code>is.planar()</code>.</p>
<p>We can also design a wire segmentation algorithm. For a wire we can change the <a href="https://doi.org/10.1016/j.patcog.2014.12.020">Limberger et al. (2015)</a> constrains to enable the detection of elongated linear features instead of flat feature.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="pba.html#cb12-1" aria-hidden="true" tabindex="-1"></a>is.linear <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z, <span class="at">th =</span> <span class="dv">10</span>) {</span>
<span id="cb12-2"><a href="pba.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  xyz <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x,y,z)</span>
<span id="cb12-3"><a href="pba.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  eigen_m <span class="ot">&lt;-</span> <span class="fu">eigen_values</span>(xyz)</span>
<span id="cb12-4"><a href="pba.html#cb12-4" aria-hidden="true" tabindex="-1"></a>  is_linear <span class="ot">&lt;-</span>  th<span class="sc">*</span>eigen_m[<span class="dv">3</span>] <span class="sc">&lt;</span> eigen_m[<span class="dv">1</span>] <span class="sc">&amp;&amp;</span> th<span class="sc">*</span>eigen_m[<span class="dv">2</span>] <span class="sc">&lt;</span> eigen_m[<span class="dv">1</span>]</span>
<span id="cb12-5"><a href="pba.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">linear =</span> is_linear))</span>
<span id="cb12-6"><a href="pba.html#cb12-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-las-wire-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><img src="lidR-book_files/figure-html/plot-las-wire-segmented-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Again, <code>lidR</code> has a dedicated function for this specific task because we believe that it is of high interest to provide a specialized and faster version of this tool.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="pba.html#cb13-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">segment_shapes</span>(las, <span class="fu">shp_line</span>(<span class="at">th =</span> <span class="dv">8</span>, <span class="at">k =</span> <span class="dv">15</span>), <span class="st">&quot;linear&quot;</span>)</span></code></pre></div>
</div>
<div id="pba-applications-coloring" class="section level3" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> Multi-spectral coloring</h3>
<p><code>point_metrics()</code> is not limited to eigen value related metrics. It is only limited by a users imagination. In the following example we will demonstrate how it an be used to attribute false colors to a multi-spectral point cloud. Multi-spectral ALS data are sampled with 3 scanners each emitting a different wavelength. The point cloud is usually provided in the form of 3 <code>.las</code> files where each file corresponds to a spectral wavelength. No matter the actual wavelength, we can consider the first band as blue, the second as red and the third as green, and thus consider that each point has a pure color.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="pba.html#cb14-1" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="st">&quot;data/chap11/PR1107_c1_ar_c.laz&quot;</span></span>
<span id="cb14-2"><a href="pba.html#cb14-2" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="st">&quot;data/chap11/PR1107_c2_ar_c.laz&quot;</span></span>
<span id="cb14-3"><a href="pba.html#cb14-3" aria-hidden="true" tabindex="-1"></a>f3 <span class="ot">&lt;-</span> <span class="st">&quot;data/chap11/PR1107_c3_ar_c.laz&quot;</span></span>
<span id="cb14-4"><a href="pba.html#cb14-4" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readMSLAS</span>(f1, f2, f3,  <span class="at">filter =</span> <span class="st">&quot;-keep_z_below 300&quot;</span>)</span>
<span id="cb14-5"><a href="pba.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las, <span class="at">color =</span> <span class="st">&quot;ScannerChannel&quot;</span>, <span class="at">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-las-multispectral-pba-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We now want to attribute an RGB value to each point. A single point being sampled with a single ‘color’ we need to use its neighborhood to define 3 bands. For each point we look in its neighbourhood, where some points are red, some are blue, and some are green. We average the intensities of each color and we consider these 3 values as the RGB color of the central point. Because some points are likely to have 0 red/blue/green neighbours we can set R, G, and B equal to <code>NA</code> for those points and later discard those points.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="pba.html#cb15-1" aria-hidden="true" tabindex="-1"></a>set.color <span class="ot">&lt;-</span> <span class="cf">function</span>(intensity, channel)</span>
<span id="cb15-2"><a href="pba.html#cb15-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb15-3"><a href="pba.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split the intensities of each channel</span></span>
<span id="cb15-4"><a href="pba.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  i1 <span class="ot">&lt;-</span> intensity[channel <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb15-5"><a href="pba.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  i2 <span class="ot">&lt;-</span> intensity[channel <span class="sc">==</span> <span class="dv">2</span>]</span>
<span id="cb15-6"><a href="pba.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  i3 <span class="ot">&lt;-</span> intensity[channel <span class="sc">==</span> <span class="dv">3</span>]</span>
<span id="cb15-7"><a href="pba.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="pba.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If one channel is missing return RGB = NA</span></span>
<span id="cb15-9"><a href="pba.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(i1) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">length</span>(i2) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">length</span>(i3) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb15-10"><a href="pba.html#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">R =</span> <span class="cn">NA_integer_</span>, <span class="at">G =</span> <span class="cn">NA_integer_</span>, <span class="at">B =</span> <span class="cn">NA_integer_</span>))</span>
<span id="cb15-11"><a href="pba.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="pba.html#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average and normalise the intensities</span></span>
<span id="cb15-13"><a href="pba.html#cb15-13" aria-hidden="true" tabindex="-1"></a>  i1 <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">mean</span>(i1))</span>
<span id="cb15-14"><a href="pba.html#cb15-14" aria-hidden="true" tabindex="-1"></a>  i2 <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">mean</span>(i2))</span>
<span id="cb15-15"><a href="pba.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  i3 <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">mean</span>(i3))</span>
<span id="cb15-16"><a href="pba.html#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i1 <span class="sc">&gt;</span> 255L) i1 <span class="ot">&lt;-</span> 255L</span>
<span id="cb15-17"><a href="pba.html#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i2 <span class="sc">&gt;</span> 255L) i2 <span class="ot">&lt;-</span> 255L</span>
<span id="cb15-18"><a href="pba.html#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i3 <span class="sc">&gt;</span> 255L) i3 <span class="ot">&lt;-</span> 255L</span>
<span id="cb15-19"><a href="pba.html#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="pba.html#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">R =</span> i1, <span class="at">G =</span> i2, <span class="at">B =</span> i3))</span>
<span id="cb15-21"><a href="pba.html#cb15-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can then apply this function with <code>point_metrics()</code> using a spherical neighborhood. The next steps being to assign the output of <code>point_metrics()</code> back into the <code>LAS</code> object for a nice display.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="pba.html#cb16-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">point_metrics</span>(las, <span class="sc">~</span><span class="fu">set.color</span>(Intensity, ScannerChannel), <span class="at">r =</span> <span class="fl">0.5</span>)</span>
<span id="cb16-2"><a href="pba.html#cb16-2" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">add_lasrgb</span>(las, M<span class="sc">$</span>R, M<span class="sc">$</span>G, M<span class="sc">$</span>B)</span>
<span id="cb16-3"><a href="pba.html#cb16-3" aria-hidden="true" tabindex="-1"></a>colored <span class="ot">&lt;-</span> <span class="fu">filter_poi</span>(las, <span class="sc">!</span><span class="fu">is.na</span>(R)) <span class="co"># remove RGB = NA</span></span>
<span id="cb16-4"><a href="pba.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(colored, <span class="at">color =</span> <span class="st">&quot;RGB&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-las-multispectral-rgb-pba-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>This method is a bit naive ‘as is’. First, the intensities returned by each channel are not comparable and required to be normalized. We could also argue about the choice of discarding RGB = <code>NA</code>. Instead we could have chosen to set a pure color. To finish, enforcing a maximum value to 255 works in this specific example because very few intensity values are actually above 255 but is meaningless in a general case. Either way, this is only a demo to show how to think out of the box with <code>point_metrics()</code>.</p>
</div>
<div id="pba-applications-outliers" class="section level3" number="13.2.4">
<h3><span class="header-section-number">13.2.4</span> Outlier filtering</h3>
<p>An outlier is a point that is alone compared to other points. Outliers are usually high points with no close neighbors. The term “no close neighbor” can have several formal definitions such as <em>no neighbors closer than x meters</em> or <em>less than n neighbors within a distance x meter</em> among others. In all cases, it can be estimated with metrics and thus <code>point_metrics()</code> enables the design of an outlier filter method.</p>
<p>Perhaps a potential exercise for the reader :) .</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="vba.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="engine.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
