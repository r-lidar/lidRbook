<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Derived metrics at the pixel level | The lidR package</title>
  <meta name="description" content="A guide to the lidR package" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Derived metrics at the pixel level | The lidR package" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A guide to the lidR package" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Derived metrics at the pixel level | The lidR package" />
  
  <meta name="twitter:description" content="A guide to the lidR package" />
  

<meta name="author" content="Jean-Romain Roussel, Tristan R.H. Goodbody, Piotr Tompalski" />


<meta name="date" content="2023-08-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cba.html"/>
<link rel="next" href="tba.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZBLHENEPMT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZBLHENEPMT');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>2</b> Reading, Plotting, Querying &amp; Validating</a>
<ul>
<li class="chapter" data-level="2.1" data-path="io.html"><a href="io.html#read"><i class="fa fa-check"></i><b>2.1</b> Reading LiDAR data using <code>readLAS</code></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="io.html"><a href="io.html#select"><i class="fa fa-check"></i><b>2.1.1</b> Parameter <code>select</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="io.html"><a href="io.html#filter"><i class="fa fa-check"></i><b>2.1.2</b> Parameter <code>filter</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="io.html"><a href="io.html#asprs-compliance"><i class="fa fa-check"></i><b>2.2</b> Validating lidar data</a></li>
<li class="chapter" data-level="2.3" data-path="io.html"><a href="io.html#plot"><i class="fa fa-check"></i><b>2.3</b> Plotting</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="io.html"><a href="io.html#plot-3d"><i class="fa fa-check"></i><b>2.3.1</b> Basic 3D rendering</a></li>
<li class="chapter" data-level="2.3.2" data-path="io.html"><a href="io.html#plot-overlay"><i class="fa fa-check"></i><b>2.3.2</b> Overlays</a></li>
<li class="chapter" data-level="2.3.3" data-path="io.html"><a href="io.html#plot-advanced"><i class="fa fa-check"></i><b>2.3.3</b> Advanced 3D rendering</a></li>
<li class="chapter" data-level="2.3.4" data-path="io.html"><a href="io.html#voxel-rendering"><i class="fa fa-check"></i><b>2.3.4</b> Voxel rendering</a></li>
<li class="chapter" data-level="2.3.5" data-path="io.html"><a href="io.html#plot-crossection"><i class="fa fa-check"></i><b>2.3.5</b> Cross sections 2D rendering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gnd.html"><a href="gnd.html"><i class="fa fa-check"></i><b>3</b> Ground classification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="gnd.html"><a href="gnd.html#pmf"><i class="fa fa-check"></i><b>3.1</b> Progressive Morphological Filter</a></li>
<li class="chapter" data-level="3.2" data-path="gnd.html"><a href="gnd.html#csf"><i class="fa fa-check"></i><b>3.2</b> Cloth Simulation Function</a></li>
<li class="chapter" data-level="3.3" data-path="gnd.html"><a href="gnd.html#mcc"><i class="fa fa-check"></i><b>3.3</b> Multiscale Curvature Classification (MCC)</a></li>
<li class="chapter" data-level="3.4" data-path="gnd.html"><a href="gnd.html#edge-artifact"><i class="fa fa-check"></i><b>3.4</b> Edge artifacts</a></li>
<li class="chapter" data-level="3.5" data-path="gnd.html"><a href="gnd.html#method-selection"><i class="fa fa-check"></i><b>3.5</b> How to choose a method and its parameters?</a></li>
<li class="chapter" data-level="3.6" data-path="gnd.html"><a href="gnd.html#other"><i class="fa fa-check"></i><b>3.6</b> Other methods</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dtm.html"><a href="dtm.html"><i class="fa fa-check"></i><b>4</b> Digital terrain model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dtm.html"><a href="dtm.html#tin"><i class="fa fa-check"></i><b>4.1</b> Triangular irregular network</a></li>
<li class="chapter" data-level="4.2" data-path="dtm.html"><a href="dtm.html#idw"><i class="fa fa-check"></i><b>4.2</b> Invert distance weighting</a></li>
<li class="chapter" data-level="4.3" data-path="dtm.html"><a href="dtm.html#kriging"><i class="fa fa-check"></i><b>4.3</b> Kriging</a></li>
<li class="chapter" data-level="4.4" data-path="dtm.html"><a href="dtm.html#dtm-pros-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="dtm.html"><a href="dtm.html#dtm-other"><i class="fa fa-check"></i><b>4.5</b> Other methods</a></li>
<li class="chapter" data-level="4.6" data-path="dtm.html"><a href="dtm.html#hillshade"><i class="fa fa-check"></i><b>4.6</b> Render shaded DTM</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="norm.html"><a href="norm.html"><i class="fa fa-check"></i><b>5</b> Height normalization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="norm.html"><a href="norm.html#norm-dtm"><i class="fa fa-check"></i><b>5.1</b> DTM normalization</a></li>
<li class="chapter" data-level="5.2" data-path="norm.html"><a href="norm.html#norm-point-cloud"><i class="fa fa-check"></i><b>5.2</b> Point cloud normalization</a></li>
<li class="chapter" data-level="5.3" data-path="norm.html"><a href="norm.html#hybrid-method"><i class="fa fa-check"></i><b>5.3</b> Hybrid method</a></li>
<li class="chapter" data-level="5.4" data-path="norm.html"><a href="norm.html#norm-pros-cons"><i class="fa fa-check"></i><b>5.4</b> Pros and cons</a></li>
<li class="chapter" data-level="5.5" data-path="norm.html"><a href="norm.html#norm-reverse"><i class="fa fa-check"></i><b>5.5</b> Reversing normalization</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chm.html"><a href="chm.html"><i class="fa fa-check"></i><b>6</b> Digital Surface Model and Canopy Height model</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chm.html"><a href="chm.html#p2r"><i class="fa fa-check"></i><b>6.1</b> Point-to-raster</a></li>
<li class="chapter" data-level="6.2" data-path="chm.html"><a href="chm.html#chm-tin"><i class="fa fa-check"></i><b>6.2</b> Triangulation</a></li>
<li class="chapter" data-level="6.3" data-path="chm.html"><a href="chm.html#pitfree"><i class="fa fa-check"></i><b>6.3</b> Pit-free algorithm</a></li>
<li class="chapter" data-level="6.4" data-path="chm.html"><a href="chm.html#chm-post-process"><i class="fa fa-check"></i><b>6.4</b> Post-processing a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="itd-its.html"><a href="itd-its.html"><i class="fa fa-check"></i><b>7</b> Indivitual tree dectection and segmentation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="itd-its.html"><a href="itd-its.html#itd"><i class="fa fa-check"></i><b>7.1</b> Individual Tree Detection (ITD)</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="itd-its.html"><a href="itd-its.html#lmffw"><i class="fa fa-check"></i><b>7.1.1</b> Local Maximum Filter with fixed windows size</a></li>
<li class="chapter" data-level="7.1.2" data-path="itd-its.html"><a href="itd-its.html#lmfvw"><i class="fa fa-check"></i><b>7.1.2</b> Local Maximum Filter with variable windows size</a></li>
<li class="chapter" data-level="7.1.3" data-path="itd-its.html"><a href="itd-its.html#lmfchm"><i class="fa fa-check"></i><b>7.1.3</b> Local Maximum Filter on a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="itd-its.html"><a href="itd-its.html#its"><i class="fa fa-check"></i><b>7.2</b> Individual Tree Segmentation (ITS)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="itd-its.html"><a href="itd-its.html#its-cloud"><i class="fa fa-check"></i><b>7.2.1</b> Segmentation of the point-cloud</a></li>
<li class="chapter" data-level="7.2.2" data-path="itd-its.html"><a href="itd-its.html#its-chm"><i class="fa fa-check"></i><b>7.2.2</b> Segmentation of the CHM</a></li>
<li class="chapter" data-level="7.2.3" data-path="itd-its.html"><a href="itd-its.html#its-comparaison"><i class="fa fa-check"></i><b>7.2.3</b> Comparaison of tree segmentations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="metrics.html"><a href="metrics.html"><i class="fa fa-check"></i><b>8</b> Derived metrics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="metrics.html"><a href="metrics.html#metrics-basics"><i class="fa fa-check"></i><b>8.1</b> The basics</a></li>
<li class="chapter" data-level="8.2" data-path="metrics.html"><a href="metrics.html#metrics-user-defined"><i class="fa fa-check"></i><b>8.2</b> User-defined metrics</a></li>
<li class="chapter" data-level="8.3" data-path="metrics.html"><a href="metrics.html#metrics-pre-defined"><i class="fa fa-check"></i><b>8.3</b> Pre-defined metrics</a></li>
<li class="chapter" data-level="8.4" data-path="metrics.html"><a href="metrics.html#metrics-3rd-party"><i class="fa fa-check"></i><b>8.4</b> Metrics using 3rd party packages</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="metrics.html"><a href="metrics.html#metrics-lmom"><i class="fa fa-check"></i><b>8.4.1</b> L-moments</a></li>
<li class="chapter" data-level="8.4.2" data-path="metrics.html"><a href="metrics.html#metrics-fractal-dims"><i class="fa fa-check"></i><b>8.4.2</b> Fractal dimensions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cba.html"><a href="cba.html"><i class="fa fa-check"></i><b>9</b> Derived metrics at the cloud level</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cba.html"><a href="cba.html#cba-overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="cba.html"><a href="cba.html#cba-applications"><i class="fa fa-check"></i><b>9.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="aba.html"><a href="aba.html"><i class="fa fa-check"></i><b>10</b> Derived metrics at the pixel level</a>
<ul>
<li class="chapter" data-level="10.1" data-path="aba.html"><a href="aba.html#aba-overview"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="aba.html"><a href="aba.html#aba-applications"><i class="fa fa-check"></i><b>10.2</b> Applications</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="aba.html"><a href="aba.html#aba-applications-modeling"><i class="fa fa-check"></i><b>10.2.1</b> Modeling</a></li>
<li class="chapter" data-level="10.2.2" data-path="aba.html"><a href="aba.html#aba-applications-density"><i class="fa fa-check"></i><b>10.2.2</b> Density</a></li>
<li class="chapter" data-level="10.2.3" data-path="aba.html"><a href="aba.html#aba-applications-intensity"><i class="fa fa-check"></i><b>10.2.3</b> Intensity</a></li>
<li class="chapter" data-level="10.2.4" data-path="aba.html"><a href="aba.html#aba-applications-other"><i class="fa fa-check"></i><b>10.2.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tba.html"><a href="tba.html"><i class="fa fa-check"></i><b>11</b> Derived metrics at the tree level</a>
<ul>
<li class="chapter" data-level="11.1" data-path="tba.html"><a href="tba.html#tba-overview"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="tba.html"><a href="tba.html#tba-applications"><i class="fa fa-check"></i><b>11.2</b> Applications</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="tba.html"><a href="tba.html#tba-applications-tree-selection"><i class="fa fa-check"></i><b>11.2.1</b> Selection of trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="tba.html"><a href="tba.html#tba-applications-tree-inventory"><i class="fa fa-check"></i><b>11.2.2</b> Tree based inventory</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="vba.html"><a href="vba.html"><i class="fa fa-check"></i><b>12</b> Derived metrics at the voxel level</a>
<ul>
<li class="chapter" data-level="12.1" data-path="vba.html"><a href="vba.html#vba-overview"><i class="fa fa-check"></i><b>12.1</b> Overview</a></li>
<li class="chapter" data-level="12.2" data-path="vba.html"><a href="vba.html#vba-applications"><i class="fa fa-check"></i><b>12.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="pba.html"><a href="pba.html"><i class="fa fa-check"></i><b>13</b> Derived metrics at point level</a>
<ul>
<li class="chapter" data-level="13.1" data-path="pba.html"><a href="pba.html#pba-overview"><i class="fa fa-check"></i><b>13.1</b> Overview</a></li>
<li class="chapter" data-level="13.2" data-path="pba.html"><a href="pba.html#pba-applications"><i class="fa fa-check"></i><b>13.2</b> Applications</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="pba.html"><a href="pba.html#pba-applications-roof"><i class="fa fa-check"></i><b>13.2.1</b> Roof segmentation</a></li>
<li class="chapter" data-level="13.2.2" data-path="pba.html"><a href="pba.html#pba-applications-wire"><i class="fa fa-check"></i><b>13.2.2</b> Lake and wire segmentation</a></li>
<li class="chapter" data-level="13.2.3" data-path="pba.html"><a href="pba.html#pba-applications-coloring"><i class="fa fa-check"></i><b>13.2.3</b> Multi-spectral coloring</a></li>
<li class="chapter" data-level="13.2.4" data-path="pba.html"><a href="pba.html#pba-applications-outliers"><i class="fa fa-check"></i><b>13.2.4</b> Outlier filtering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="engine.html"><a href="engine.html"><i class="fa fa-check"></i><b>14</b> <code>LAScatalog</code> processing engine (1/2)</a>
<ul>
<li class="chapter" data-level="14.1" data-path="engine.html"><a href="engine.html#engine-rationale"><i class="fa fa-check"></i><b>14.1</b> Rationale for <code>LAScatalog</code> functionality</a></li>
<li class="chapter" data-level="14.2" data-path="engine.html"><a href="engine.html#engine-engine"><i class="fa fa-check"></i><b>14.2</b> The <code>LAScatalog</code> engine</a></li>
<li class="chapter" data-level="14.3" data-path="engine.html"><a href="engine.html#engine-lascatalog"><i class="fa fa-check"></i><b>14.3</b> Read a collection of files</a></li>
<li class="chapter" data-level="14.4" data-path="engine.html"><a href="engine.html#engine-asprs-compliance"><i class="fa fa-check"></i><b>14.4</b> Validation</a></li>
<li class="chapter" data-level="14.5" data-path="engine.html"><a href="engine.html#engine-clip"><i class="fa fa-check"></i><b>14.5</b> Extract Regions of interest</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="engine.html"><a href="engine.html#engine-clip-single"><i class="fa fa-check"></i><b>14.5.1</b> Extract a single ROI</a></li>
<li class="chapter" data-level="14.5.2" data-path="engine.html"><a href="engine.html#engine-clip-multiple"><i class="fa fa-check"></i><b>14.5.2</b> Multiple extractions</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="engine.html"><a href="engine.html#engine-options"><i class="fa fa-check"></i><b>14.6</b> Modification of default behavior</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="engine.html"><a href="engine.html#engine-options-ondisk"><i class="fa fa-check"></i><b>14.6.1</b> Multiple extractions on disk</a></li>
<li class="chapter" data-level="14.6.2" data-path="engine.html"><a href="engine.html#engine-options-index"><i class="fa fa-check"></i><b>14.6.2</b> Multiple extraction with point cloud indexation</a></li>
<li class="chapter" data-level="14.6.3" data-path="engine.html"><a href="engine.html#summary"><i class="fa fa-check"></i><b>14.6.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="engine.html"><a href="engine.html#engine-gnd-classification"><i class="fa fa-check"></i><b>14.7</b> Ground classification</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="engine.html"><a href="engine.html#engine-options-chunk"><i class="fa fa-check"></i><b>14.7.1</b> Chunk processing</a></li>
<li class="chapter" data-level="14.7.2" data-path="engine.html"><a href="engine.html#engine-options-chunk-buffer"><i class="fa fa-check"></i><b>14.7.2</b> Modifying buffers</a></li>
<li class="chapter" data-level="14.7.3" data-path="engine.html"><a href="engine.html#engine-options-chunk-size"><i class="fa fa-check"></i><b>14.7.3</b> Modify the chunk size</a></li>
<li class="chapter" data-level="14.7.4" data-path="engine.html"><a href="engine.html#engine-options-parallel"><i class="fa fa-check"></i><b>14.7.4</b> Parallel processing</a></li>
<li class="chapter" data-level="14.7.5" data-path="engine.html"><a href="engine.html#summary-1"><i class="fa fa-check"></i><b>14.7.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="engine.html"><a href="engine.html#engine-dtm"><i class="fa fa-check"></i><b>14.8</b> Digital Terrain Model</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="engine.html"><a href="engine.html#engine-dtm-inmemory"><i class="fa fa-check"></i><b>14.8.1</b> In memory DTM</a></li>
<li class="chapter" data-level="14.8.2" data-path="engine.html"><a href="engine.html#engine-dtm-ondisk"><i class="fa fa-check"></i><b>14.8.2</b> On disk DTM</a></li>
<li class="chapter" data-level="14.8.3" data-path="engine.html"><a href="engine.html#summary-2"><i class="fa fa-check"></i><b>14.8.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="engine.html"><a href="engine.html#engine-normalization"><i class="fa fa-check"></i><b>14.9</b> Height normalization</a></li>
<li class="chapter" data-level="14.10" data-path="engine.html"><a href="engine.html#engine-aba"><i class="fa fa-check"></i><b>14.10</b> Area Based Approach</a>
<ul>
<li class="chapter" data-level="14.10.1" data-path="engine.html"><a href="engine.html#summary-3"><i class="fa fa-check"></i><b>14.10.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.11" data-path="engine.html"><a href="engine.html#engine-itd"><i class="fa fa-check"></i><b>14.11</b> Individual Tree Detection</a>
<ul>
<li class="chapter" data-level="14.11.1" data-path="engine.html"><a href="engine.html#summary-4"><i class="fa fa-check"></i><b>14.11.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.12" data-path="engine.html"><a href="engine.html#engine-its"><i class="fa fa-check"></i><b>14.12</b> Individual Tree Segmentation</a></li>
<li class="chapter" data-level="14.13" data-path="engine.html"><a href="engine.html#engine-retile"><i class="fa fa-check"></i><b>14.13</b> Retile a catalog</a>
<ul>
<li class="chapter" data-level="14.13.1" data-path="engine.html"><a href="engine.html#retile-a-catalog-into-smaller-files"><i class="fa fa-check"></i><b>14.13.1</b> Retile a catalog into smaller files</a></li>
<li class="chapter" data-level="14.13.2" data-path="engine.html"><a href="engine.html#add-a-buffer-around-each-file"><i class="fa fa-check"></i><b>14.13.2</b> Add a buffer around each file</a></li>
<li class="chapter" data-level="14.13.3" data-path="engine.html"><a href="engine.html#create-a-new-collection-with-only-first-returns"><i class="fa fa-check"></i><b>14.13.3</b> Create a new collection with only first returns</a></li>
<li class="chapter" data-level="14.13.4" data-path="engine.html"><a href="engine.html#create-a-new-collection-of-small-and-buffered-ground-returns-in-parallel"><i class="fa fa-check"></i><b>14.13.4</b> Create a new collection of small and buffered ground returns in parallel</a></li>
</ul></li>
<li class="chapter" data-level="14.14" data-path="engine.html"><a href="engine.html#engine-independent-files"><i class="fa fa-check"></i><b>14.14</b> The case of ground inventories</a></li>
<li class="chapter" data-level="14.15" data-path="engine.html"><a href="engine.html#engine-summary-sheet"><i class="fa fa-check"></i><b>14.15</b> Summary of available options</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="engine2.html"><a href="engine2.html"><i class="fa fa-check"></i><b>15</b> LAScatalog processing engine (2/2)</a>
<ul>
<li class="chapter" data-level="15.1" data-path="engine2.html"><a href="engine2.html#engine-catalog-apply"><i class="fa fa-check"></i><b>15.1</b> <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.2" data-path="engine2.html"><a href="engine2.html#engine-user-function-generic"><i class="fa fa-check"></i><b>15.2</b> Create user-defined function</a></li>
<li class="chapter" data-level="15.3" data-path="engine2.html"><a href="engine2.html#engine-user-function-extended"><i class="fa fa-check"></i><b>15.3</b> Create an intermediate function for <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.4" data-path="engine2.html"><a href="engine2.html#engine-user-function-lascatalog"><i class="fa fa-check"></i><b>15.4</b> Make a user-friendly function for third party users</a></li>
<li class="chapter" data-level="15.5" data-path="engine2.html"><a href="engine2.html#engine-user-function-safe"><i class="fa fa-check"></i><b>15.5</b> Make a safe function for third party users</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="modeling-aba.html"><a href="modeling-aba.html"><i class="fa fa-check"></i><b>16</b> The Area-Based Approach (ABA) to forest modelling</a>
<ul>
<li class="chapter" data-level="16.1" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-read-data"><i class="fa fa-check"></i><b>16.1</b> Read in data</a></li>
<li class="chapter" data-level="16.2" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-build-data"><i class="fa fa-check"></i><b>16.2</b> ABA database building</a></li>
<li class="chapter" data-level="16.3" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-build-model"><i class="fa fa-check"></i><b>16.3</b> Statistical modeling</a></li>
<li class="chapter" data-level="16.4" data-path="modeling-aba.html"><a href="modeling-aba.html#wall-to-wall-modelling"><i class="fa fa-check"></i><b>16.4</b> Wall to wall modelling</a></li>
<li class="chapter" data-level="16.5" data-path="modeling-aba.html"><a href="modeling-aba.html#calculate-wall-to-wall-predictions"><i class="fa fa-check"></i><b>16.5</b> Calculate wall-to-wall predictions</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="outbox.html"><a href="outbox.html"><i class="fa fa-check"></i><b>17</b> Thinking outside the box</a>
<ul>
<li class="chapter" data-level="17.1" data-path="outbox.html"><a href="outbox.html#outbox-custom-metrics"><i class="fa fa-check"></i><b>17.1</b> New complex metrics in ABA</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="outbox.html"><a href="outbox.html#outbox-distance-returns"><i class="fa fa-check"></i><b>17.1.1</b> Distance between returns</a></li>
<li class="chapter" data-level="17.1.2" data-path="outbox.html"><a href="outbox.html#outbox-rumple-index"><i class="fa fa-check"></i><b>17.1.2</b> Rumple index</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="outbox.html"><a href="outbox.html#outbox-multispectral-coloring"><i class="fa fa-check"></i><b>17.2</b> Multi-spectral coloring</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="spatial-indexing.html"><a href="spatial-indexing.html"><i class="fa fa-check"></i><b>18</b> Spatial indexing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-intro"><i class="fa fa-check"></i><b>18.1</b> Introduction to spatial indexes</a></li>
<li class="chapter" data-level="18.2" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-las"><i class="fa fa-check"></i><b>18.2</b> Spatial indexes for LAS objects</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-oveview"><i class="fa fa-check"></i><b>18.2.1</b> Overview</a></li>
<li class="chapter" data-level="18.2.2" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-strategies"><i class="fa fa-check"></i><b>18.2.2</b> Spatial indexes and selection strategies</a></li>
<li class="chapter" data-level="18.2.3" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-cpp-api"><i class="fa fa-check"></i><b>18.2.3</b> C++ API</a></li>
<li class="chapter" data-level="18.2.4" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-benchmark"><i class="fa fa-check"></i><b>18.2.4</b> Benchmark</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-files"><i class="fa fa-check"></i><b>18.3</b> Spatial index for LAS files</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="plugins.html"><a href="plugins.html"><i class="fa fa-check"></i><b>19</b> <code>lidR</code> plugin system</a>
<ul>
<li class="chapter" data-level="19.1" data-path="plugins.html"><a href="plugins.html#plugin-system"><i class="fa fa-check"></i><b>19.1</b> Understanding lidR algorithms</a></li>
<li class="chapter" data-level="19.2" data-path="plugins.html"><a href="plugins.html#plugin-creation"><i class="fa fa-check"></i><b>19.2</b> Creation of the <code>mba</code> algorithm</a></li>
<li class="chapter" data-level="19.3" data-path="plugins.html"><a href="plugins.html#plugin-extensions"><i class="fa fa-check"></i><b>19.3</b> What about other algorithms?</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The <code>lidR</code> package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aba" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Derived metrics at the pixel level<a href="aba.html#aba" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="aba-overview" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Overview<a href="aba.html#aba-overview" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The “pixel” level of regularization corresponds to the computation of derived metrics for regularly spaced locations in 2D. Derived metrics calculated at pixel level are the basis of the area-based approach (ABA) that we discuss with more details in section <a href="modeling-aba.html#modeling-aba">16</a>. In brief, the ABA allows the creation of wall-to-wall predictions of forest inventory attributes (e.g. basal area or total volume per hectare) by linking ALS variables with field measured references. ABA is one application of derived metrics at the pixel level but not the only one.</p>
<p>As seen in sections <a href="metrics.html#metrics">8</a> and <a href="cba.html#cba">9</a> calculating derived metrics is straightforward. The user only needs to provide a formula to calculate the metric of interest. For example, to calculate the average height (<code>mean(Z)</code>) of all points within 10 x 10 m pixels we can run the following:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="aba.html#cb1-1" aria-hidden="true" tabindex="-1"></a>hmean <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">mean</span>(Z), <span class="dv">10</span>) <span class="co"># calculate mean at 10 m</span></span>
<span id="cb1-2"><a href="aba.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hmean, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>))</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-hmean-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>The returned <code>hmean</code> object is a raster. The default format is <code>terra</code> but an argument <code>pkg</code> allows for <code>RasterLayer</code> or <code>stars</code> outputs:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="aba.html#cb2-1" aria-hidden="true" tabindex="-1"></a>hmean</span>
<span id="cb2-2"><a href="aba.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class       : SpatRaster </span></span>
<span id="cb2-3"><a href="aba.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; dimensions  : 50, 50, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb2-4"><a href="aba.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; resolution  : 10, 10  (x, y)</span></span>
<span id="cb2-5"><a href="aba.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; extent      : 338000, 338500, 5238500, 5239000  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb2-6"><a href="aba.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; coord. ref. : WGS 84 / UTM zone 19N (EPSG:32619) </span></span>
<span id="cb2-7"><a href="aba.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; source(s)   : memory</span></span>
<span id="cb2-8"><a href="aba.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; name        :         V1 </span></span>
<span id="cb2-9"><a href="aba.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; min value   :  0.2670795 </span></span>
<span id="cb2-10"><a href="aba.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; max value   : 14.0898504</span></span></code></pre></div>
<p>As described in sections <a href="metrics.html#metrics">8</a> and <a href="cba.html#cba">9</a>, to calculate more than one metric at a time a custom function needs to be created first. The function can contain any number of metrics but needs to return a labeled <code>list</code>. For example, to calculate the mean and standard deviation of point heights, the following function can be created. In this case the return object is a multilayer raster is returned.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="aba.html#cb3-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co"># user-defined fucntion</span></span>
<span id="cb3-2"><a href="aba.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x), <span class="at">sd =</span> <span class="fu">sd</span>(x))</span>
<span id="cb3-3"><a href="aba.html#cb3-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-4"><a href="aba.html#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="aba.html#cb3-5" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">f</span>(Z), <span class="dv">10</span>) <span class="co"># calculate grid metrics</span></span>
<span id="cb3-6"><a href="aba.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(metrics, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>))</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-custom-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>The functions that specify which metrics to calculate can of course contain any number of metrics. The most commonly used metrics are already predefined in <code>lidR</code> - the <code>stdmetrics()</code> function contains metrics that summarize the vertical distribution of points, their intensities, and return structure. The complete list of all metrics can be found in the <a href="https://github.com/Jean-Romain/lidR/wiki/stdmetrics">lidR wiki page</a>. To use the predefined list of 56 metrics we can run the <code>pixel_metrics()</code> function as follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="aba.html#cb4-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, .stdmetrics, <span class="dv">10</span>) <span class="co"># calculate standard metrics</span></span>
<span id="cb4-2"><a href="aba.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(metrics, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>))</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-stdmetrics-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Because of the flexibility in defining metrics, it is very easy to extend basic functionality to create new, non-standard metrics. For example, below we demonstrate how the coefficient of variation and inter-quartile range can be calculated:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="aba.html#cb5-1" aria-hidden="true" tabindex="-1"></a>metrics_custom <span class="ot">&lt;-</span> <span class="cf">function</span>(z) { <span class="co"># user defined function</span></span>
<span id="cb5-2"><a href="aba.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb5-3"><a href="aba.html#cb5-3" aria-hidden="true" tabindex="-1"></a>   coef_var <span class="ot">&lt;-</span>   <span class="fu">sd</span>(z) <span class="sc">/</span> <span class="fu">mean</span>(z) <span class="sc">*</span> <span class="dv">100</span>, <span class="co"># coefficient of variation</span></span>
<span id="cb5-4"><a href="aba.html#cb5-4" aria-hidden="true" tabindex="-1"></a>   iqr <span class="ot">&lt;-</span>  <span class="fu">IQR</span>(z)) <span class="co"># inter-quartile range</span></span>
<span id="cb5-5"><a href="aba.html#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="aba.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="aba.html#cb5-7" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">metrics_custom</span>(<span class="at">z=</span>Z), <span class="dv">10</span>) <span class="co"># calculate grid metrics</span></span>
<span id="cb5-8"><a href="aba.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(metrics, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">25</span>))</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-custom-2-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="aba-applications" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Applications<a href="aba.html#aba-applications" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="aba-applications-modeling" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Modeling<a href="aba.html#aba-applications-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All <code>*_metrics</code> functions can map any kind of formula as long as it returns a number or a list of numbers, meaning that that it’s possible to input an expression derived from a predictive model to map the resource. In the section <a href="cba.html#cba">9</a> we made a model that can be written <span class="math inline">\(0.7018 \times pzabove2 + 0.9268 \times zmax\)</span>. We can map this predictive model with a resolution of 10 meters:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="aba.html#cb6-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fl">0.7018</span> <span class="sc">*</span> <span class="fu">sum</span>(Z <span class="sc">&gt;</span> <span class="dv">2</span>)<span class="sc">/</span><span class="fu">length</span>(Z) <span class="sc">+</span> <span class="fl">0.9268</span> <span class="sc">*</span><span class="fu">max</span>(Z), <span class="dv">20</span>) <span class="co"># predicting model mapping</span></span>
<span id="cb6-2"><a href="aba.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prediction, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>)) <span class="co"># some plotting</span></span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-model-1.png" width="662.4" style="display: block; margin: auto;" /></p>
</div>
<div id="aba-applications-density" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Density<a href="aba.html#aba-applications-density" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Point density is the number of points within a pixel divided by the area of the pixel.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="aba.html#cb7-1" aria-hidden="true" tabindex="-1"></a>density <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">length</span>(Z)<span class="sc">/</span><span class="dv">16</span>, <span class="dv">4</span>) <span class="co"># calculate density</span></span>
<span id="cb7-2"><a href="aba.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(density, <span class="at">col =</span> <span class="fu">gray.colors</span>(<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">1</span>)) <span class="co"># some plotting</span></span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-density-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>When using only the first returns, the same formula gives the pulse density instead of the point density</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="aba.html#cb8-1" aria-hidden="true" tabindex="-1"></a>density <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">length</span>(Z)<span class="sc">/</span><span class="dv">16</span>, <span class="dv">4</span>, <span class="at">filter =</span> <span class="sc">~</span>ReturnNumber <span class="sc">==</span> 1L)</span></code></pre></div>
</div>
<div id="aba-applications-intensity" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Intensity<a href="aba.html#aba-applications-intensity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It’s possible to generate a map of the average intensity of first return only</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="aba.html#cb9-1" aria-hidden="true" tabindex="-1"></a>imap <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">mean</span>(Intensity), <span class="dv">4</span>, <span class="at">filter =</span> <span class="sc">~</span>ReturnNumber <span class="sc">==</span> 1L) <span class="co"># mapping average intensity</span></span>
<span id="cb9-2"><a href="aba.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(imap, <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">25</span>))</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-imean-1.png" width="662.4" style="display: block; margin: auto;" /></p>
</div>
<div id="aba-applications-other" class="section level3 hasAnchor" number="10.2.4">
<h3><span class="header-section-number">10.2.4</span> Other<a href="aba.html#aba-applications-other" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Many other raster-based applications can be derived with adequate metrics. In section <a href="outbox.html#outbox">17</a> we will see some out of the box possibilities to demonstrate how the concept of metrics can be leveraged to design new applications. A simple uncommon application could be to map the ratio between multiple returns and single returns.</p>
<p>To count single returns we can count the number of points where number of returns equal to 1. To count the number of multiple returns we can count the number of points with a return number equal to 1 <strong>AND</strong> a return number above 1.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="aba.html#cb10-1" aria-hidden="true" tabindex="-1"></a>mymetric <span class="ot">&lt;-</span> <span class="cf">function</span>(return_number, number_of_returns) { <span class="co">#user-defined function</span></span>
<span id="cb10-2"><a href="aba.html#cb10-2" aria-hidden="true" tabindex="-1"></a>  nsingle <span class="ot">&lt;-</span> <span class="fu">sum</span>(number_of_returns <span class="sc">==</span> 1L)</span>
<span id="cb10-3"><a href="aba.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  nmultiple <span class="ot">&lt;-</span> <span class="fu">sum</span>(return_number <span class="sc">==</span> 1L <span class="sc">&amp;</span> number_of_returns <span class="sc">&gt;</span> 1L)</span>
<span id="cb10-4"><a href="aba.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">n_single =</span> nsingle,</span>
<span id="cb10-5"><a href="aba.html#cb10-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_multiple =</span> nmultiple,</span>
<span id="cb10-6"><a href="aba.html#cb10-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">ratio =</span> nmultiple<span class="sc">/</span>nsingle))</span>
<span id="cb10-7"><a href="aba.html#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-8"><a href="aba.html#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="aba.html#cb10-9" aria-hidden="true" tabindex="-1"></a>rmap <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">mymetric</span>(ReturnNumber, NumberOfReturns), <span class="dv">8</span>) <span class="co"># mapping retunrs</span></span>
<span id="cb10-10"><a href="aba.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rmap, <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">50</span>))</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-raster-ratio-1.png" width="672" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<script async src="//static.getclicky.com/101377207.js"></script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101377207ns.gif" /></p></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="cba.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tba.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
