<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Digital Surface Model and Canopy Height model | The lidR package</title>
  <meta name="description" content="A guide to the lidR package" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Digital Surface Model and Canopy Height model | The lidR package" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A guide to the lidR package" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Digital Surface Model and Canopy Height model | The lidR package" />
  
  <meta name="twitter:description" content="A guide to the lidR package" />
  

<meta name="author" content="Jean-Romain Roussel, Tristan R.H. Goodbody, Piotr Tompalski" />


<meta name="date" content="2023-08-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="norm.html"/>
<link rel="next" href="itd-its.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZBLHENEPMT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZBLHENEPMT');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>2</b> Reading, Plotting, Querying &amp; Validating</a>
<ul>
<li class="chapter" data-level="2.1" data-path="io.html"><a href="io.html#read"><i class="fa fa-check"></i><b>2.1</b> Reading LiDAR data using <code>readLAS</code></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="io.html"><a href="io.html#select"><i class="fa fa-check"></i><b>2.1.1</b> Parameter <code>select</code></a></li>
<li class="chapter" data-level="2.1.2" data-path="io.html"><a href="io.html#filter"><i class="fa fa-check"></i><b>2.1.2</b> Parameter <code>filter</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="io.html"><a href="io.html#asprs-compliance"><i class="fa fa-check"></i><b>2.2</b> Validating lidar data</a></li>
<li class="chapter" data-level="2.3" data-path="io.html"><a href="io.html#plot"><i class="fa fa-check"></i><b>2.3</b> Plotting</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="io.html"><a href="io.html#plot-3d"><i class="fa fa-check"></i><b>2.3.1</b> Basic 3D rendering</a></li>
<li class="chapter" data-level="2.3.2" data-path="io.html"><a href="io.html#plot-overlay"><i class="fa fa-check"></i><b>2.3.2</b> Overlays</a></li>
<li class="chapter" data-level="2.3.3" data-path="io.html"><a href="io.html#plot-advanced"><i class="fa fa-check"></i><b>2.3.3</b> Advanced 3D rendering</a></li>
<li class="chapter" data-level="2.3.4" data-path="io.html"><a href="io.html#voxel-rendering"><i class="fa fa-check"></i><b>2.3.4</b> Voxel rendering</a></li>
<li class="chapter" data-level="2.3.5" data-path="io.html"><a href="io.html#plot-crossection"><i class="fa fa-check"></i><b>2.3.5</b> Cross sections 2D rendering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="gnd.html"><a href="gnd.html"><i class="fa fa-check"></i><b>3</b> Ground classification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="gnd.html"><a href="gnd.html#pmf"><i class="fa fa-check"></i><b>3.1</b> Progressive Morphological Filter</a></li>
<li class="chapter" data-level="3.2" data-path="gnd.html"><a href="gnd.html#csf"><i class="fa fa-check"></i><b>3.2</b> Cloth Simulation Function</a></li>
<li class="chapter" data-level="3.3" data-path="gnd.html"><a href="gnd.html#mcc"><i class="fa fa-check"></i><b>3.3</b> Multiscale Curvature Classification (MCC)</a></li>
<li class="chapter" data-level="3.4" data-path="gnd.html"><a href="gnd.html#edge-artifact"><i class="fa fa-check"></i><b>3.4</b> Edge artifacts</a></li>
<li class="chapter" data-level="3.5" data-path="gnd.html"><a href="gnd.html#method-selection"><i class="fa fa-check"></i><b>3.5</b> How to choose a method and its parameters?</a></li>
<li class="chapter" data-level="3.6" data-path="gnd.html"><a href="gnd.html#other"><i class="fa fa-check"></i><b>3.6</b> Other methods</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dtm.html"><a href="dtm.html"><i class="fa fa-check"></i><b>4</b> Digital terrain model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dtm.html"><a href="dtm.html#tin"><i class="fa fa-check"></i><b>4.1</b> Triangular irregular network</a></li>
<li class="chapter" data-level="4.2" data-path="dtm.html"><a href="dtm.html#idw"><i class="fa fa-check"></i><b>4.2</b> Invert distance weighting</a></li>
<li class="chapter" data-level="4.3" data-path="dtm.html"><a href="dtm.html#kriging"><i class="fa fa-check"></i><b>4.3</b> Kriging</a></li>
<li class="chapter" data-level="4.4" data-path="dtm.html"><a href="dtm.html#dtm-pros-cons"><i class="fa fa-check"></i><b>4.4</b> Pros and cons</a></li>
<li class="chapter" data-level="4.5" data-path="dtm.html"><a href="dtm.html#dtm-other"><i class="fa fa-check"></i><b>4.5</b> Other methods</a></li>
<li class="chapter" data-level="4.6" data-path="dtm.html"><a href="dtm.html#hillshade"><i class="fa fa-check"></i><b>4.6</b> Render shaded DTM</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="norm.html"><a href="norm.html"><i class="fa fa-check"></i><b>5</b> Height normalization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="norm.html"><a href="norm.html#norm-dtm"><i class="fa fa-check"></i><b>5.1</b> DTM normalization</a></li>
<li class="chapter" data-level="5.2" data-path="norm.html"><a href="norm.html#norm-point-cloud"><i class="fa fa-check"></i><b>5.2</b> Point cloud normalization</a></li>
<li class="chapter" data-level="5.3" data-path="norm.html"><a href="norm.html#hybrid-method"><i class="fa fa-check"></i><b>5.3</b> Hybrid method</a></li>
<li class="chapter" data-level="5.4" data-path="norm.html"><a href="norm.html#norm-pros-cons"><i class="fa fa-check"></i><b>5.4</b> Pros and cons</a></li>
<li class="chapter" data-level="5.5" data-path="norm.html"><a href="norm.html#norm-reverse"><i class="fa fa-check"></i><b>5.5</b> Reversing normalization</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chm.html"><a href="chm.html"><i class="fa fa-check"></i><b>6</b> Digital Surface Model and Canopy Height model</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chm.html"><a href="chm.html#p2r"><i class="fa fa-check"></i><b>6.1</b> Point-to-raster</a></li>
<li class="chapter" data-level="6.2" data-path="chm.html"><a href="chm.html#chm-tin"><i class="fa fa-check"></i><b>6.2</b> Triangulation</a></li>
<li class="chapter" data-level="6.3" data-path="chm.html"><a href="chm.html#pitfree"><i class="fa fa-check"></i><b>6.3</b> Pit-free algorithm</a></li>
<li class="chapter" data-level="6.4" data-path="chm.html"><a href="chm.html#chm-post-process"><i class="fa fa-check"></i><b>6.4</b> Post-processing a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="itd-its.html"><a href="itd-its.html"><i class="fa fa-check"></i><b>7</b> Indivitual tree dectection and segmentation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="itd-its.html"><a href="itd-its.html#itd"><i class="fa fa-check"></i><b>7.1</b> Individual Tree Detection (ITD)</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="itd-its.html"><a href="itd-its.html#lmffw"><i class="fa fa-check"></i><b>7.1.1</b> Local Maximum Filter with fixed windows size</a></li>
<li class="chapter" data-level="7.1.2" data-path="itd-its.html"><a href="itd-its.html#lmfvw"><i class="fa fa-check"></i><b>7.1.2</b> Local Maximum Filter with variable windows size</a></li>
<li class="chapter" data-level="7.1.3" data-path="itd-its.html"><a href="itd-its.html#lmfchm"><i class="fa fa-check"></i><b>7.1.3</b> Local Maximum Filter on a CHM</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="itd-its.html"><a href="itd-its.html#its"><i class="fa fa-check"></i><b>7.2</b> Individual Tree Segmentation (ITS)</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="itd-its.html"><a href="itd-its.html#its-cloud"><i class="fa fa-check"></i><b>7.2.1</b> Segmentation of the point-cloud</a></li>
<li class="chapter" data-level="7.2.2" data-path="itd-its.html"><a href="itd-its.html#its-chm"><i class="fa fa-check"></i><b>7.2.2</b> Segmentation of the CHM</a></li>
<li class="chapter" data-level="7.2.3" data-path="itd-its.html"><a href="itd-its.html#its-comparaison"><i class="fa fa-check"></i><b>7.2.3</b> Comparaison of tree segmentations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="metrics.html"><a href="metrics.html"><i class="fa fa-check"></i><b>8</b> Derived metrics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="metrics.html"><a href="metrics.html#metrics-basics"><i class="fa fa-check"></i><b>8.1</b> The basics</a></li>
<li class="chapter" data-level="8.2" data-path="metrics.html"><a href="metrics.html#metrics-user-defined"><i class="fa fa-check"></i><b>8.2</b> User-defined metrics</a></li>
<li class="chapter" data-level="8.3" data-path="metrics.html"><a href="metrics.html#metrics-pre-defined"><i class="fa fa-check"></i><b>8.3</b> Pre-defined metrics</a></li>
<li class="chapter" data-level="8.4" data-path="metrics.html"><a href="metrics.html#metrics-3rd-party"><i class="fa fa-check"></i><b>8.4</b> Metrics using 3rd party packages</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="metrics.html"><a href="metrics.html#metrics-lmom"><i class="fa fa-check"></i><b>8.4.1</b> L-moments</a></li>
<li class="chapter" data-level="8.4.2" data-path="metrics.html"><a href="metrics.html#metrics-fractal-dims"><i class="fa fa-check"></i><b>8.4.2</b> Fractal dimensions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cba.html"><a href="cba.html"><i class="fa fa-check"></i><b>9</b> Derived metrics at the cloud level</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cba.html"><a href="cba.html#cba-overview"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="cba.html"><a href="cba.html#cba-applications"><i class="fa fa-check"></i><b>9.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="aba.html"><a href="aba.html"><i class="fa fa-check"></i><b>10</b> Derived metrics at the pixel level</a>
<ul>
<li class="chapter" data-level="10.1" data-path="aba.html"><a href="aba.html#aba-overview"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="aba.html"><a href="aba.html#aba-applications"><i class="fa fa-check"></i><b>10.2</b> Applications</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="aba.html"><a href="aba.html#aba-applications-modeling"><i class="fa fa-check"></i><b>10.2.1</b> Modeling</a></li>
<li class="chapter" data-level="10.2.2" data-path="aba.html"><a href="aba.html#aba-applications-density"><i class="fa fa-check"></i><b>10.2.2</b> Density</a></li>
<li class="chapter" data-level="10.2.3" data-path="aba.html"><a href="aba.html#aba-applications-intensity"><i class="fa fa-check"></i><b>10.2.3</b> Intensity</a></li>
<li class="chapter" data-level="10.2.4" data-path="aba.html"><a href="aba.html#aba-applications-other"><i class="fa fa-check"></i><b>10.2.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tba.html"><a href="tba.html"><i class="fa fa-check"></i><b>11</b> Derived metrics at the tree level</a>
<ul>
<li class="chapter" data-level="11.1" data-path="tba.html"><a href="tba.html#tba-overview"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="tba.html"><a href="tba.html#tba-applications"><i class="fa fa-check"></i><b>11.2</b> Applications</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="tba.html"><a href="tba.html#tba-applications-tree-selection"><i class="fa fa-check"></i><b>11.2.1</b> Selection of trees</a></li>
<li class="chapter" data-level="11.2.2" data-path="tba.html"><a href="tba.html#tba-applications-tree-inventory"><i class="fa fa-check"></i><b>11.2.2</b> Tree based inventory</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="vba.html"><a href="vba.html"><i class="fa fa-check"></i><b>12</b> Derived metrics at the voxel level</a>
<ul>
<li class="chapter" data-level="12.1" data-path="vba.html"><a href="vba.html#vba-overview"><i class="fa fa-check"></i><b>12.1</b> Overview</a></li>
<li class="chapter" data-level="12.2" data-path="vba.html"><a href="vba.html#vba-applications"><i class="fa fa-check"></i><b>12.2</b> Applications</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="pba.html"><a href="pba.html"><i class="fa fa-check"></i><b>13</b> Derived metrics at point level</a>
<ul>
<li class="chapter" data-level="13.1" data-path="pba.html"><a href="pba.html#pba-overview"><i class="fa fa-check"></i><b>13.1</b> Overview</a></li>
<li class="chapter" data-level="13.2" data-path="pba.html"><a href="pba.html#pba-applications"><i class="fa fa-check"></i><b>13.2</b> Applications</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="pba.html"><a href="pba.html#pba-applications-roof"><i class="fa fa-check"></i><b>13.2.1</b> Roof segmentation</a></li>
<li class="chapter" data-level="13.2.2" data-path="pba.html"><a href="pba.html#pba-applications-wire"><i class="fa fa-check"></i><b>13.2.2</b> Lake and wire segmentation</a></li>
<li class="chapter" data-level="13.2.3" data-path="pba.html"><a href="pba.html#pba-applications-coloring"><i class="fa fa-check"></i><b>13.2.3</b> Multi-spectral coloring</a></li>
<li class="chapter" data-level="13.2.4" data-path="pba.html"><a href="pba.html#pba-applications-outliers"><i class="fa fa-check"></i><b>13.2.4</b> Outlier filtering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="engine.html"><a href="engine.html"><i class="fa fa-check"></i><b>14</b> <code>LAScatalog</code> processing engine (1/2)</a>
<ul>
<li class="chapter" data-level="14.1" data-path="engine.html"><a href="engine.html#engine-rationale"><i class="fa fa-check"></i><b>14.1</b> Rationale for <code>LAScatalog</code> functionality</a></li>
<li class="chapter" data-level="14.2" data-path="engine.html"><a href="engine.html#engine-engine"><i class="fa fa-check"></i><b>14.2</b> The <code>LAScatalog</code> engine</a></li>
<li class="chapter" data-level="14.3" data-path="engine.html"><a href="engine.html#engine-lascatalog"><i class="fa fa-check"></i><b>14.3</b> Read a collection of files</a></li>
<li class="chapter" data-level="14.4" data-path="engine.html"><a href="engine.html#engine-asprs-compliance"><i class="fa fa-check"></i><b>14.4</b> Validation</a></li>
<li class="chapter" data-level="14.5" data-path="engine.html"><a href="engine.html#engine-clip"><i class="fa fa-check"></i><b>14.5</b> Extract Regions of interest</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="engine.html"><a href="engine.html#engine-clip-single"><i class="fa fa-check"></i><b>14.5.1</b> Extract a single ROI</a></li>
<li class="chapter" data-level="14.5.2" data-path="engine.html"><a href="engine.html#engine-clip-multiple"><i class="fa fa-check"></i><b>14.5.2</b> Multiple extractions</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="engine.html"><a href="engine.html#engine-options"><i class="fa fa-check"></i><b>14.6</b> Modification of default behavior</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="engine.html"><a href="engine.html#engine-options-ondisk"><i class="fa fa-check"></i><b>14.6.1</b> Multiple extractions on disk</a></li>
<li class="chapter" data-level="14.6.2" data-path="engine.html"><a href="engine.html#engine-options-index"><i class="fa fa-check"></i><b>14.6.2</b> Multiple extraction with point cloud indexation</a></li>
<li class="chapter" data-level="14.6.3" data-path="engine.html"><a href="engine.html#summary"><i class="fa fa-check"></i><b>14.6.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="engine.html"><a href="engine.html#engine-gnd-classification"><i class="fa fa-check"></i><b>14.7</b> Ground classification</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="engine.html"><a href="engine.html#engine-options-chunk"><i class="fa fa-check"></i><b>14.7.1</b> Chunk processing</a></li>
<li class="chapter" data-level="14.7.2" data-path="engine.html"><a href="engine.html#engine-options-chunk-buffer"><i class="fa fa-check"></i><b>14.7.2</b> Modifying buffers</a></li>
<li class="chapter" data-level="14.7.3" data-path="engine.html"><a href="engine.html#engine-options-chunk-size"><i class="fa fa-check"></i><b>14.7.3</b> Modify the chunk size</a></li>
<li class="chapter" data-level="14.7.4" data-path="engine.html"><a href="engine.html#engine-options-parallel"><i class="fa fa-check"></i><b>14.7.4</b> Parallel processing</a></li>
<li class="chapter" data-level="14.7.5" data-path="engine.html"><a href="engine.html#summary-1"><i class="fa fa-check"></i><b>14.7.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="engine.html"><a href="engine.html#engine-dtm"><i class="fa fa-check"></i><b>14.8</b> Digital Terrain Model</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="engine.html"><a href="engine.html#engine-dtm-inmemory"><i class="fa fa-check"></i><b>14.8.1</b> In memory DTM</a></li>
<li class="chapter" data-level="14.8.2" data-path="engine.html"><a href="engine.html#engine-dtm-ondisk"><i class="fa fa-check"></i><b>14.8.2</b> On disk DTM</a></li>
<li class="chapter" data-level="14.8.3" data-path="engine.html"><a href="engine.html#summary-2"><i class="fa fa-check"></i><b>14.8.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="engine.html"><a href="engine.html#engine-normalization"><i class="fa fa-check"></i><b>14.9</b> Height normalization</a></li>
<li class="chapter" data-level="14.10" data-path="engine.html"><a href="engine.html#engine-aba"><i class="fa fa-check"></i><b>14.10</b> Area Based Approach</a>
<ul>
<li class="chapter" data-level="14.10.1" data-path="engine.html"><a href="engine.html#summary-3"><i class="fa fa-check"></i><b>14.10.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.11" data-path="engine.html"><a href="engine.html#engine-itd"><i class="fa fa-check"></i><b>14.11</b> Individual Tree Detection</a>
<ul>
<li class="chapter" data-level="14.11.1" data-path="engine.html"><a href="engine.html#summary-4"><i class="fa fa-check"></i><b>14.11.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="14.12" data-path="engine.html"><a href="engine.html#engine-its"><i class="fa fa-check"></i><b>14.12</b> Individual Tree Segmentation</a></li>
<li class="chapter" data-level="14.13" data-path="engine.html"><a href="engine.html#engine-retile"><i class="fa fa-check"></i><b>14.13</b> Retile a catalog</a>
<ul>
<li class="chapter" data-level="14.13.1" data-path="engine.html"><a href="engine.html#retile-a-catalog-into-smaller-files"><i class="fa fa-check"></i><b>14.13.1</b> Retile a catalog into smaller files</a></li>
<li class="chapter" data-level="14.13.2" data-path="engine.html"><a href="engine.html#add-a-buffer-around-each-file"><i class="fa fa-check"></i><b>14.13.2</b> Add a buffer around each file</a></li>
<li class="chapter" data-level="14.13.3" data-path="engine.html"><a href="engine.html#create-a-new-collection-with-only-first-returns"><i class="fa fa-check"></i><b>14.13.3</b> Create a new collection with only first returns</a></li>
<li class="chapter" data-level="14.13.4" data-path="engine.html"><a href="engine.html#create-a-new-collection-of-small-and-buffered-ground-returns-in-parallel"><i class="fa fa-check"></i><b>14.13.4</b> Create a new collection of small and buffered ground returns in parallel</a></li>
</ul></li>
<li class="chapter" data-level="14.14" data-path="engine.html"><a href="engine.html#engine-independent-files"><i class="fa fa-check"></i><b>14.14</b> The case of ground inventories</a></li>
<li class="chapter" data-level="14.15" data-path="engine.html"><a href="engine.html#engine-summary-sheet"><i class="fa fa-check"></i><b>14.15</b> Summary of available options</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="engine2.html"><a href="engine2.html"><i class="fa fa-check"></i><b>15</b> LAScatalog processing engine (2/2)</a>
<ul>
<li class="chapter" data-level="15.1" data-path="engine2.html"><a href="engine2.html#engine-catalog-apply"><i class="fa fa-check"></i><b>15.1</b> <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.2" data-path="engine2.html"><a href="engine2.html#engine-user-function-generic"><i class="fa fa-check"></i><b>15.2</b> Create user-defined function</a></li>
<li class="chapter" data-level="15.3" data-path="engine2.html"><a href="engine2.html#engine-user-function-extended"><i class="fa fa-check"></i><b>15.3</b> Create an intermediate function for <code>catalog_apply()</code></a></li>
<li class="chapter" data-level="15.4" data-path="engine2.html"><a href="engine2.html#engine-user-function-lascatalog"><i class="fa fa-check"></i><b>15.4</b> Make a user-friendly function for third party users</a></li>
<li class="chapter" data-level="15.5" data-path="engine2.html"><a href="engine2.html#engine-user-function-safe"><i class="fa fa-check"></i><b>15.5</b> Make a safe function for third party users</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="modeling-aba.html"><a href="modeling-aba.html"><i class="fa fa-check"></i><b>16</b> The Area-Based Approach (ABA) to forest modelling</a>
<ul>
<li class="chapter" data-level="16.1" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-read-data"><i class="fa fa-check"></i><b>16.1</b> Read in data</a></li>
<li class="chapter" data-level="16.2" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-build-data"><i class="fa fa-check"></i><b>16.2</b> ABA database building</a></li>
<li class="chapter" data-level="16.3" data-path="modeling-aba.html"><a href="modeling-aba.html#modeling-build-model"><i class="fa fa-check"></i><b>16.3</b> Statistical modeling</a></li>
<li class="chapter" data-level="16.4" data-path="modeling-aba.html"><a href="modeling-aba.html#wall-to-wall-modelling"><i class="fa fa-check"></i><b>16.4</b> Wall to wall modelling</a></li>
<li class="chapter" data-level="16.5" data-path="modeling-aba.html"><a href="modeling-aba.html#calculate-wall-to-wall-predictions"><i class="fa fa-check"></i><b>16.5</b> Calculate wall-to-wall predictions</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="outbox.html"><a href="outbox.html"><i class="fa fa-check"></i><b>17</b> Thinking outside the box</a>
<ul>
<li class="chapter" data-level="17.1" data-path="outbox.html"><a href="outbox.html#outbox-custom-metrics"><i class="fa fa-check"></i><b>17.1</b> New complex metrics in ABA</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="outbox.html"><a href="outbox.html#outbox-distance-returns"><i class="fa fa-check"></i><b>17.1.1</b> Distance between returns</a></li>
<li class="chapter" data-level="17.1.2" data-path="outbox.html"><a href="outbox.html#outbox-rumple-index"><i class="fa fa-check"></i><b>17.1.2</b> Rumple index</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="outbox.html"><a href="outbox.html#outbox-multispectral-coloring"><i class="fa fa-check"></i><b>17.2</b> Multi-spectral coloring</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="spatial-indexing.html"><a href="spatial-indexing.html"><i class="fa fa-check"></i><b>18</b> Spatial indexing</a>
<ul>
<li class="chapter" data-level="18.1" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-intro"><i class="fa fa-check"></i><b>18.1</b> Introduction to spatial indexes</a></li>
<li class="chapter" data-level="18.2" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-las"><i class="fa fa-check"></i><b>18.2</b> Spatial indexes for LAS objects</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-oveview"><i class="fa fa-check"></i><b>18.2.1</b> Overview</a></li>
<li class="chapter" data-level="18.2.2" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-strategies"><i class="fa fa-check"></i><b>18.2.2</b> Spatial indexes and selection strategies</a></li>
<li class="chapter" data-level="18.2.3" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-cpp-api"><i class="fa fa-check"></i><b>18.2.3</b> C++ API</a></li>
<li class="chapter" data-level="18.2.4" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-benchmark"><i class="fa fa-check"></i><b>18.2.4</b> Benchmark</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="spatial-indexing.html"><a href="spatial-indexing.html#spatial-indexing-files"><i class="fa fa-check"></i><b>18.3</b> Spatial index for LAS files</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="plugins.html"><a href="plugins.html"><i class="fa fa-check"></i><b>19</b> <code>lidR</code> plugin system</a>
<ul>
<li class="chapter" data-level="19.1" data-path="plugins.html"><a href="plugins.html#plugin-system"><i class="fa fa-check"></i><b>19.1</b> Understanding lidR algorithms</a></li>
<li class="chapter" data-level="19.2" data-path="plugins.html"><a href="plugins.html#plugin-creation"><i class="fa fa-check"></i><b>19.2</b> Creation of the <code>mba</code> algorithm</a></li>
<li class="chapter" data-level="19.3" data-path="plugins.html"><a href="plugins.html#plugin-extensions"><i class="fa fa-check"></i><b>19.3</b> What about other algorithms?</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The <code>lidR</code> package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chm" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Digital Surface Model and Canopy Height model<a href="chm.html#chm" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Digital Surface Models (DSM) and Canopy Height Models (CHM) are raster layers that represent - more or less - the highest elevation of ALS returns. In the case of a normalized point cloud, the derived surface represents the canopy height (for vegetated areas) and is referred to as CHM. When the original (non-normalized) point cloud with absolute elevations is used, the derived layer represents the elevation of the top of the canopy above sea level, and is referred to as DSM. Both surface models are derived using the same algorithms, with the only difference being the elevation values of the point cloud.</p>
<p>Different methods exist to create DSMs and CHMs. In the most simple case, a grid can be created with a user-defined pixel size and the elevations of the highest point can be assigned to each grid cell. This is called point-to-raster. More complex methods have been presented in the literature. In this section we will use the normalized <code>MixedConifer.laz</code> data set, which is included internally within <code>lidR</code> to create reproducible examples.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="chm.html#cb2-1" aria-hidden="true" tabindex="-1"></a>LASfile <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;MixedConifer.laz&quot;</span>, <span class="at">package =</span><span class="st">&quot;lidR&quot;</span>)</span>
<span id="cb2-2"><a href="chm.html#cb2-2" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(LASfile)</span>
<span id="cb2-3"><a href="chm.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="p2r" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Point-to-raster<a href="chm.html#p2r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Point-to-raster algorithms are conceptually simple, consisting of establishing a grid at a user defined resolution and attributing the elevation of the highest point to each pixel. Algorithmic implementations are computationally simple and extremely fast. In the first example we will set the pixel size to <code>1</code> and set <code>algorithm = p2r()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="chm.html#cb3-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="dv">1</span>, <span class="at">algorithm =</span> <span class="fu">p2r</span>())</span>
<span id="cb3-2"><a href="chm.html#cb3-2" aria-hidden="true" tabindex="-1"></a>col <span class="ot">&lt;-</span> <span class="fu">height.colors</span>(<span class="dv">25</span>)</span>
<span id="cb3-3"><a href="chm.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-p2r-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>One drawback of the point-to-raster method is that some pixels can be empty if the grid resolution is too fine for the available point density. Some pixels may then fall within a location that does not contain any points, and as a result the value is not defined.</p>
<p>In the following example we will use the exact same method, but increase the spatial resolution of the raster by changing the pixel size to 0.5 m.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="chm.html#cb4-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">p2r</span>())</span>
<span id="cb4-2"><a href="chm.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-p2r-2-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>We can clearly see that there are a lot of empty pixels in the derived surface that correspond to <code>NA</code> pixels in the point cloud. The spatial resolution was increased, however the CHM contains to many voids.</p>
<p>One option to reduce the number of voids in the surface model is to replace every point in the point cloud with a disk of a known radius (e.g. 15 cm). This operation is meant to simulate the fact that the laser footprint is not a point, but rather a circular area. It is equivalent to computing the CHM from a densified point cloud in a way that tries to have a physical meaning.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="chm.html#cb5-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">p2r</span>(<span class="at">subcircle =</span> <span class="fl">0.15</span>))</span>
<span id="cb5-2"><a href="chm.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-p2r-subcirc-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>This CHM is the CHM computed <em>“as if”</em> the point cloud was the following</p>
<p><img src="lidR-book_files/figure-html/plot-las-subcircled-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>We can zoom in to see the small disks that replace each point.</p>
<p><img src="lidR-book_files/figure-html/plot-las-subcircled-zoom-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The <code>p2r()</code> function contains one additional argument that allows to interpolate the remaining empty pixels. Empty pixels are interpolated using methods described in section <a href="dtm.html#dtm">4</a>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="chm.html#cb6-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="fu">p2r</span>(<span class="fl">0.2</span>, <span class="at">na.fill =</span> <span class="fu">tin</span>()))</span>
<span id="cb6-2"><a href="chm.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-p2r-nafill-1.png" width="662.4" style="display: block; margin: auto;" /></p>
</div>
<div id="chm-tin" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Triangulation<a href="chm.html#chm-tin" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The triangulation algorithm works by first creating a triangular irregular network (TIN) using first returns only, followed by interpolation within each triangle to compute an elevation value for each pixel of a raster. In its simplest form, this method consists of a strict 2-D triangulation of first returns. Despite being more complex compared to the point-to-raster algorithm, an advantage of the triangulation approach is that it is parameter free and it does not output empty pixels, regardless of the resolution of the output raster (i.e. the entire area is interpolated).</p>
<p>Like point-to-raster however, the TIN method can lead to gaps and other noise in the surface - referred to as “pits” - that are attributable to first returns that penetrated deep into the canopy. Pits can make individual tree segmentation more difficult and change the texture of the canopy in a unrealistic way. To avoid this issue the CHM is often smoothed in post processing in an attempt to produce a more realistic surface with fewer pits and less noise. To create a surface model using triangulation we use <code>algorithm = dsmtin()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="chm.html#cb7-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">dsmtin</span>())</span>
<span id="cb7-2"><a href="chm.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-dsmtin-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>The triangulation method may also be weak when a lot of points are missing. We can generate an example using the <code>Topography.laz</code> data set that contains empty lakes.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="chm.html#cb8-1" aria-hidden="true" tabindex="-1"></a>LASfile <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;Topography.laz&quot;</span>, <span class="at">package =</span> <span class="st">&quot;lidR&quot;</span>)</span>
<span id="cb8-2"><a href="chm.html#cb8-2" aria-hidden="true" tabindex="-1"></a>las2 <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(LASfile)</span>
<span id="cb8-3"><a href="chm.html#cb8-3" aria-hidden="true" tabindex="-1"></a>las2 <span class="ot">&lt;-</span> <span class="fu">normalize_height</span>(las2, <span class="at">algorithm =</span> <span class="fu">tin</span>())</span>
<span id="cb8-4"><a href="chm.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las2, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-las-topo-chm-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In this case the CHM is incorrectly computed in the empty lakes</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="chm.html#cb9-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las2, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">dsmtin</span>())</span>
<span id="cb9-2"><a href="chm.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-dsmtin-lakes-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>To fix this, one option is to use the <code>max_edge</code> argument, which defines the maximum edge of a triangle allowed in the Delaunay triangulation. By default this argument is set to <code>0</code> meaning that no triangle are removed. If set to e.g. 8 it means that every triangle with an edge longer than 8 will be discarded from the triangulation.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="chm.html#cb10-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las2, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">dsmtin</span>(<span class="at">max_edge =</span> <span class="dv">8</span>))</span>
<span id="cb10-2"><a href="chm.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-dsmtin-maxedge-1.png" width="662.4" style="display: block; margin: auto;" /></p>
</div>
<div id="pitfree" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Pit-free algorithm<a href="chm.html#pitfree" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>More advanced algorithms have also been designed that avoid pits during the computation step instead of requiring post-processing. <a href="https://www.ingentaconnect.com/content/asprs/pers/2014/00000080/00000009/art00003?crawler=true">Khosravipour et al. (2014)</a> proposed a ‘pit-free’ algorithm, which consists of a series of sequential height thresholds where Delaunay triangulations are applied to first returns. For each threshold, the triangulation is cleaned of triangles that are too large, similar to the example given in the previous section. In a final step, the partial rasters are stacked and only the highest pixels of each raster are retained (figure below). The output is a DSM that is expected to be natively free of pits without using any post-processing or correction methods.</p>
<center>
<img src="images/DSM/pitfree.png" />
</center>
<p>To understand this method better, we can reproduce the figure above with <code>algorithm = dsmtin()</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="chm.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The first layer is a regular triangulation</span></span>
<span id="cb11-2"><a href="chm.html#cb11-2" aria-hidden="true" tabindex="-1"></a>layer0 <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">dsmtin</span>())</span>
<span id="cb11-3"><a href="chm.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="chm.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Triangulation of first return above 10 m</span></span>
<span id="cb11-5"><a href="chm.html#cb11-5" aria-hidden="true" tabindex="-1"></a>above10 <span class="ot">&lt;-</span> <span class="fu">filter_poi</span>(las, Z <span class="sc">&gt;=</span> <span class="dv">10</span>)</span>
<span id="cb11-6"><a href="chm.html#cb11-6" aria-hidden="true" tabindex="-1"></a>layer10 <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(above10, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">dsmtin</span>(<span class="at">max_edge =</span> <span class="fl">1.5</span>))</span>
<span id="cb11-7"><a href="chm.html#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="chm.html#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Triangulation of first return above 20 m</span></span>
<span id="cb11-9"><a href="chm.html#cb11-9" aria-hidden="true" tabindex="-1"></a>above20 <span class="ot">&lt;-</span> <span class="fu">filter_poi</span>(above10, Z <span class="sc">&gt;=</span> <span class="dv">20</span>)</span>
<span id="cb11-10"><a href="chm.html#cb11-10" aria-hidden="true" tabindex="-1"></a>layer20 <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(above20, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">dsmtin</span>(<span class="at">max_edge =</span> <span class="fl">1.5</span>))</span>
<span id="cb11-11"><a href="chm.html#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="chm.html#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The final surface is a stack of the partial rasters</span></span>
<span id="cb11-13"><a href="chm.html#cb11-13" aria-hidden="true" tabindex="-1"></a>dsm <span class="ot">&lt;-</span> layer0</span>
<span id="cb11-14"><a href="chm.html#cb11-14" aria-hidden="true" tabindex="-1"></a>dsm[] <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="fu">as.numeric</span>(layer0[]), <span class="fu">as.numeric</span>(layer10[]), <span class="fu">as.numeric</span>(layer20[]), <span class="at">na.rm =</span> T)</span>
<span id="cb11-15"><a href="chm.html#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="chm.html#cb11-16" aria-hidden="true" tabindex="-1"></a>layers <span class="ot">&lt;-</span> <span class="fu">c</span>(layer0, layer10, layer20, dsm)</span>
<span id="cb11-17"><a href="chm.html#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(layers) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Base&quot;</span>, <span class="st">&quot;Layer10m&quot;</span>, <span class="st">&quot;Layer20m&quot;</span>, <span class="st">&quot;pitfree&quot;</span>)</span>
<span id="cb11-18"><a href="chm.html#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(layers, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-pitfree-build-1.png" width="710.4" style="display: block; margin: auto;" /></p>
<p>In practice, the internal implementation of <code>pitfree()</code> works much like the example above but is easier to use.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="chm.html#cb12-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="fu">pitfree</span>(<span class="at">thresholds =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>), <span class="at">max_edge =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)))</span>
<span id="cb12-2"><a href="chm.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-pitfree-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>By increasing the <code>max_edge</code> argument for the pit-free triangulation part from <code>1.5</code> to <code>2</code> the CHM becomes smoother but also less realistic:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="chm.html#cb13-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="fu">pitfree</span>(<span class="at">max_edge =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>)))</span>
<span id="cb13-2"><a href="chm.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-pitfree-maxedge-1.png" width="662.4" style="display: block; margin: auto;" /></p>
<p>Similarly to point-to-raster, the pit-free algorithm in <code>lidR</code> also includes a <code>subcircle</code> option that replaces each first return by a disk made of 8 points. Because it would be too computationally demanding to triangulate 8 times more points, the choice was made to select only the highest point of each pixel after subcircling to perform the triangulation.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="chm.html#cb14-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="fu">pitfree</span>(<span class="at">subcircle =</span> <span class="fl">0.15</span>))</span>
<span id="cb14-2"><a href="chm.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-pitfree-subcirc-1.png" width="662.4" style="display: block; margin: auto;" /></p>
</div>
<div id="chm-post-process" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Post-processing a CHM<a href="chm.html#chm-post-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>CHMs are usually post-processed to smooth or to fill empty pixels. This is mainly because most publications use a point-to-raster approach without any tweaks. One may want to apply a post-processing step to the CHM. Sadly <code>lidR</code> does not provide any tools for that. <code>lidR</code> is a point cloud oriented software. Once a function has returned a raster, the job of the <code>lidR</code> package has ended. Further work requires other dedicated tools to process rasters. The <code>terra</code> package is one of those. The code below presents a simple option to fill NAs and smooth a CHM with the <code>terra</code> package. For more details see the documentation of the package <code>terra</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="chm.html#cb15-1" aria-hidden="true" tabindex="-1"></a>fill.na <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">i=</span><span class="dv">5</span>) { <span class="cf">if</span> (<span class="fu">is.na</span>(x)[i]) { <span class="fu">return</span>(<span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) } <span class="cf">else</span> { <span class="fu">return</span>(x[i]) }}</span>
<span id="cb15-2"><a href="chm.html#cb15-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb15-3"><a href="chm.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="chm.html#cb15-4" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">p2r</span>(<span class="at">subcircle =</span> <span class="fl">0.15</span>), <span class="at">pkg =</span> <span class="st">&quot;terra&quot;</span>)</span>
<span id="cb15-5"><a href="chm.html#cb15-5" aria-hidden="true" tabindex="-1"></a>filled <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">focal</span>(chm, w, <span class="at">fun =</span> fill.na)</span>
<span id="cb15-6"><a href="chm.html#cb15-6" aria-hidden="true" tabindex="-1"></a>smoothed <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">focal</span>(chm, w, <span class="at">fun =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-7"><a href="chm.html#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="chm.html#cb15-8" aria-hidden="true" tabindex="-1"></a>chms <span class="ot">&lt;-</span> <span class="fu">c</span>(chm, filled, smoothed)</span>
<span id="cb15-9"><a href="chm.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(chms) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Base&quot;</span>, <span class="st">&quot;Filled&quot;</span>, <span class="st">&quot;Smoothed&quot;</span>)</span>
<span id="cb15-10"><a href="chm.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chms, <span class="at">col =</span> col)</span></code></pre></div>
<p><img src="lidR-book_files/figure-html/plot-chm-postprod-1.png" width="710.4" style="display: block; margin: auto;" /></p>

</div>
</div>
<script async src="//static.getclicky.com/101377207.js"></script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101377207ns.gif" /></p></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="norm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="itd-its.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
